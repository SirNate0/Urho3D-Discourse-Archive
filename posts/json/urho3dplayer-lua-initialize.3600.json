{"post_stream":{"posts":[{"id":20931,"name":"","username":"zakk","avatar_template":"/user_avatar/discourse.urho3d.io/zakk/{size}/871_2.png","created_at":"2017-09-23T15:23:36.264Z","cooked":"\u003cp\u003eHello,\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://urho3d.github.io/documentation/1.4/_main_loop.html\" rel=\"nofollow noopener\"\u003eAccording to the documention of main loop\u003c/a\u003e, \u003cem\u003eInitialize()\u003c/em\u003e is a class called when Urho3d is started, before entering the main loop.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://urho3d.github.io/documentation/1.4/class_urho3_d_1_1_engine.html\" rel=\"nofollow noopener\"\u003eClicking on \u003cem\u003eInitialize()\u003c/em\u003e on the above link lead here\u003c/a\u003e. I don‚Äôt see functions related to \u003cem\u003eRenderPath\u003c/em\u003e changing. I‚Äôm confused from the start \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/confused.png?v=5\" title=\":confused:\" class=\"emoji\" alt=\":confused:\"\u003e .\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eUrho3dPlayer\u003c/code\u003e has a number of parameters which are obviously related to \u003cem\u003eInitialize()\u003c/em\u003e class.\u003c/p\u003e\n\u003cp\u003eNot everything is possible from the command line parameters. For example, you cannot change the default RenderPath, which is by default \u003cem\u003eRenderPaths/Forward.xml\u003c/em\u003e .\u003c/p\u003e\n\u003cp\u003eSo what if i want to use \u003cem\u003eInitialize()\u003c/em\u003e functions in a Lua script run by \u003ccode\u003eUrho3dPlayer\u003c/code\u003e ?\u003c/p\u003e\n\u003cp\u003eAt first, i tried a sort of overriding of \u003cem\u003eInitialize()\u003c/em\u003e, with putting this in my script:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003efunction Initialize()\u003cbr\u003e\nprint(‚ÄúInitialize has been called.‚Äù)\u003cbr\u003e\nend\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWhen running the script, the above code is obviously not called.\u003c/p\u003e\n\u003cp\u003eI‚Äôve grepped \u003cem\u003eRenderPath\u003c/em\u003e from the Lua samples scripts, and found reference in \u003cem\u003e09_MultipleViewports.lua\u003c/em\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003elocal effectRenderPath = viewport:GetRenderPath():Clone()\u003cbr\u003e\neffectRenderPath:Append(cache:GetResource(‚ÄúXMLFile‚Äù, ‚ÄúPostProcess/Bloom.xml‚Äù))\u003cbr\u003e\n(‚Ä¶)\u003cbr\u003e\neffectRenderPath:SetEnabled(‚ÄúFXAA2‚Äù, false)\u003cbr\u003e\nviewport:SetRenderPath(effectRenderPath)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eI understand the code above, but is doesn‚Äôt seem related to an \u003cem\u003eInitialize()\u003c/em\u003e class or function.\u003c/p\u003e\n\u003cp\u003eIs \u003cem\u003eInitialize()\u003c/em\u003e a function, and not a class ? How can i use it from a script ?\u003cbr\u003e\nShould i use \u003cem\u003eViewport\u003c/em\u003e global object for changing parameters at start, and forget about \u003cem\u003eInitialize()\u003c/em\u003e ?\u003c/p\u003e\n\u003cp\u003eThank you for reading \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003cbr\u003e\nZakk.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-09-23T15:25:55.519Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":36,"reads":37,"readers_count":36,"score":187.4,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://urho3d.github.io/documentation/1.4/_main_loop.html","internal":false,"reflection":false,"title":"Urho3D - Documentation","clicks":7},{"url":"https://urho3d.github.io/documentation/1.4/class_urho3_d_1_1_engine.html","internal":false,"reflection":false,"title":"Urho3D - Documentation","clicks":4}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":116,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20932,"name":"Eugene Kozlov","username":"Eugene","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png","created_at":"2017-09-23T16:38:36.798Z","cooked":"\u003cp\u003eWhat‚Äôs your use case? What do you want to do?\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-09-23T16:38:36.798Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":31,"readers_count":30,"score":16.2,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"Eugene Kozlov","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":484,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20933,"name":"","username":"zakk","avatar_template":"/user_avatar/discourse.urho3d.io/zakk/{size}/871_2.png","created_at":"2017-09-23T16:43:47.477Z","cooked":"\u003cp\u003eI want to understand how to use Urho3D with Lua and the script player (\u003ccode\u003eUrho3DPlayer\u003c/code\u003e).\u003c/p\u003e\n\u003cp\u003eThat‚Äôs why i‚Äôm reading all i can find, and try to understand from the beginning : i don‚Äôt want to include \u003cem\u003eSample.lua\u003c/em\u003e , i rather like to understand a bit what‚Äôs behind the Lua curtains.\u003c/p\u003e\n\u003cp\u003eUrho3D is quite mysterious for me, so i try to solve questions one by one.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-09-23T16:44:59.000Z","reply_count":1,"reply_to_post_number":2,"quote_count":0,"incoming_link_count":0,"reads":31,"readers_count":30,"score":11.2,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":116,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20934,"name":"Eugene Kozlov","username":"Eugene","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png","created_at":"2017-09-23T18:46:54.630Z","cooked":"\u003caside class=\"onebox whitelistedgeneric\"\u003e\n  \u003cheader class=\"source\"\u003e\n      \u003ca href=\"https://urho3d.github.io/documentation/HEAD/_running.html\" target=\"_blank\" rel=\"nofollow noopener\"\u003eUrho3D\u003c/a\u003e\n  \u003c/header\u003e\n  \u003carticle class=\"onebox-body\"\u003e\n    \n\n\u003ch3\u003e\u003ca href=\"https://urho3d.github.io/documentation/HEAD/_running.html\" target=\"_blank\" rel=\"nofollow noopener\"\u003eRunning Urho3D player application\u003c/a\u003e\u003c/h3\u003e\n\n\u003cp\u003eUrho3D is a free lightweight, cross-platform 2D and 3D game engine implemented in C++ and released under the MIT license. Greatly inspired by OGRE and Horde3D.\u003c/p\u003e\n\n\n  \u003c/article\u003e\n  \u003cdiv class=\"onebox-metadata\"\u003e\n    \n    \n  \u003c/div\u003e\n  \u003cdiv style=\"clear: both\"\u003e\u003c/div\u003e\n\u003c/aside\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eAn application script is required to have the function void Start(), which will be executed before starting the engine main loop.\u003c/p\u003e\n\u003c/blockquote\u003e","post_number":4,"post_type":1,"updated_at":"2017-09-23T18:46:54.630Z","reply_count":0,"reply_to_post_number":3,"quote_count":0,"incoming_link_count":0,"reads":29,"readers_count":28,"score":20.8,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"Eugene Kozlov","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://urho3d.github.io/documentation/HEAD/_running.html","internal":false,"reflection":false,"title":"Urho3D - Documentation - Running Urho3D player application","clicks":3}],"read":true,"user_title":"Core developer","title_is_group":false,"reply_to_user":{"username":"zakk","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/zakk/{size}/871_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":484,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20936,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2017-09-24T01:47:07.793Z","cooked":"\u003cp\u003eInitialize is a method in the Engine class. It‚Äôs just a huge pile of boilerplate code, and nothing in there is controllable directly from the Lua scripting system, or really concerns the Lua system in any direct way. Various defaults, such as default renderpath, are set (not directly from Initialize, but usually within the related subsystem(s)) but most can be overridden or changed through command-line args or code. For example, you can change the renderpath using one of 3 command-line args: -deferred, -prepass, or -renderpath with a path argument to a renderpath descriptor. Additionally, you can specify a renderpath manually in code as in the examples you have already looked at.\u003c/p\u003e\n\u003cp\u003eI don‚Äôt really recommend modifying the library to change the defaults; they‚Äôre default for a reason (usually, because it‚Äôs the simplest/most widely supportable option) and it‚Äôs easy enough to change on an application basis.\u003c/p\u003e\n\u003cp\u003eIt‚Äôs reasonable to not want to use Sample.lua, but it‚Äôs still a good idea to at least peek at it and get an idea for what‚Äôs expected. While a lot of boilerplate initialization is done behind the scenes, there are still tasks that you need to perform for your own situation such as setting a cursor if needed, constructing a UI (the Sample sets up a very basic one, but in real use you‚Äôll need to get a bit more elaborate) and building a scene. Sample.lua is just a simple framework that handles certain tasks that repeat across all the various examples. It‚Äôs suitable for examples, and that‚Äôs it. Still, it does show the basic outline of what you have to do. (At the very least, provide a Start() function and put some stuff in it.)\u003c/p\u003e\n\u003cp\u003eAs far as using Urho3D with Lua, it‚Äôs very similar to using it with AngelScript. The Lua glue code tries very hard to keep the 2 paradigms at least superficially similar, and in fact it is easier to use the two scripting systems than it is to use C++, due to the fact that you don‚Äôt need to manually write the various boilerplate required for creating a custom C++ component (RegisterFactory, etc‚Ä¶), and you don‚Äôt need to touch the code in Application as you might need to if you are writing a C++ program. The ScriptObject functionality works pretty well out of the box.\u003c/p\u003e\n\u003cp\u003eThere are some wrinkles with the Lua system that don‚Äôt occur with the AngelScript system, however, due to the nature of the Lua garbage-collection system and the tolua binding generator used to build the binding boilerplate code. There are certain situations you really need to steer clear of. For example, creating Urho3D objects inside nested loops is usually Bad‚Ñ¢. I‚Äôm talking about situations such as this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efor x=0,img.width-1,1 do\n    for y=0,img.height-1,1 do\n        img:SetPixel(x,y,Color(1,1,1,1))\n    end\nend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis kind of thing is bad, and the larger that the image is the worse it gets. (Naturally, this exact example isn‚Äôt likely something you‚Äôll be doing, but it is feasible that you might be building images in some fashion. I procedurally generate a lot of various images/maps/buffers, so I run into it a LOT.) The reason this is bad is that tolua keeps various behind-the-scenes tables to hold the objects that are created (Color objects, in this example). Inside a nested loop like this, the count of objects grows quite large, and thus the table they are stored in grows quite large. When the objects are garbage-collected they go away, but those large tables that they were stored in remain, and will remain large and unwieldy, for the duration of your program execution time. Some periodic processing is done on these tables during garbage collection phases. Do this enough, with large enough object counts, and you will see some pretty nasty performance consequences.\u003c/p\u003e\n\u003cp\u003eThis doesn‚Äôt occur with the AngelScript system; it‚Äôs purely an artifact of the creaky and aging tolua++ binding generator. However, as long as you steer clear of this kind of situation, it should work well. (I get around it in my own projects by writing custom C++ code and building a custom Urho3DPlayer.exe with the custom bits exposed to Lua script.)\u003c/p\u003e\n\u003cp\u003eThere are other weirdnesses related to the fact that Lua garbage-collects everything, and the GC doesn‚Äôt mesh perfectly with Urho3D‚Äôs SharedPtr memory management system, not as nicely as AngelScript does at any rate. I love Lua, and I use it pretty much exclusively since I find AngelScript kind of awkward to use in many respects. Nevertheless, there is a pretty strong argument that can be made in favor of using AngelScript, since its integration with Urho3D is significantly less quirky.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-09-24T10:25:03.453Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":25,"readers_count":24,"score":25.0,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":true},{"id":20949,"name":"","username":"zakk","avatar_template":"/user_avatar/discourse.urho3d.io/zakk/{size}/871_2.png","created_at":"2017-09-24T13:13:42.183Z","cooked":"\u003cp\u003eThank you  for your answer, it was really informative.\u003c/p\u003e\n\u003cp\u003eMy biggest problem with Urho3D is maybe that i‚Äôm not sure on how to understand the concepts involved so i peek here and i poke there. For example , some days ago, i wasn‚Äôt aware of what is a \u003cem\u003erenderpath\u003c/em\u003e. I finally understood reading the documentation that it‚Äôs a sort of state machine with predefined steps for drawing a scene.\u003c/p\u003e\n\u003cp\u003eIt‚Äôs just an example, because the whole Urho3d seems big for me. I know that \u003cem\u003erenderpath\u003c/em\u003e is not specific to Urho3d, it‚Äôs just to mention that i surely lack some basic notions in modern videogame world.\u003c/p\u003e\n\u003cp\u003eFor a more specific Urho3d notion, i must admit that \u003ccode\u003eVariantMap\u003c/code\u003e are obscure for me. Parsing the doc, i‚Äôve seen it is a template for defining a dictionary of \u003ccode\u003eVariant\u003c/code\u003e types (the basic objects of Urho3d, i guess). Fine, but what about Lua ? Is this existing directly ? Or may be it has to be implemented with a table of \u003ccode\u003eVariant\u003c/code\u003e maybe ? You see, just an example, but questions like these raise often these days.\u003c/p\u003e\n\u003cp\u003eThat said, of course i‚Äôve looked what \u003cem\u003eSample.lua\u003c/em\u003e was doing , as it does a lot and as it will be something to be done in my own code , one way or another. But i don‚Äôt want to blindly call boilerplate code, that‚Äôs why i‚Äôm trying to do things myself without helpers (even if i end up using helpers when i have understand the basic principles)\u003c/p\u003e\n\u003cp\u003eI‚Äôm using Lua for quite a long time (discovered with the game Naev, and never left since). I am not very interested in Angel Script, even if it‚Äôs more suit to use with Urho3d, because of it‚Äôs narrow audience (i don‚Äôt know the language itself, except it is statically typed, which is uncommun for a script language).\u003c/p\u003e\n\u003cp\u003eThank also for mentionning traps with objects use in Lua.\u003cbr\u003e\nI was thinking gullibly that something like img:SetPixel was just a thin wrapper to a \u003ccode\u003eSetPixel\u003c/code\u003e function, applied to its \u003ccode\u003eself\u003c/code\u003e object. I‚Äôm using Lua this way, when i come to C API. But here of course, we are talking about C++ and \u003ccode\u003etolua\u003c/code\u003e.\u003cbr\u003e\nSo i keep this in mind.\u003c/p\u003e\n\u003cp\u003eI guess the correct way for texture generation would be to generate the pixel buffer with Lua, without Urho3D objects call, and then passing the whole buffer to an Urho3D texture. Of course, i would avoid doing this each frame, as in this case, we are hitting Lua limitations \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=5\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e\n\u003cp\u003eAnother annoying thing i have encountered with Lua in Urho3FD is its intensive use of userdata. I know it‚Äôs the pillar of exchanges between C and Lua , but for something like \u003ccode\u003efunction handle_update(eventType,eventData)\u003c/code\u003e , i‚Äôd rather like to have two tables for \u003cem\u003eeventType\u003c/em\u003e and \u003cem\u003eeventData\u003c/em\u003e, rather than an userdata, which i cannot explore with it‚Äôs associated metatable (only standards fields in the metatable). I think doing this way (with userdate) is surely better for performances. And as i‚Äôve found \u003ca href=\"https://urho3d.github.io/documentation/HEAD/_event_list.html\" rel=\"nofollow noopener\"\u003ethis\u003c/a\u003e , there is no problem with events \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/wink.png?v=5\" title=\":wink:\" class=\"emoji\" alt=\":wink:\"\u003e\u003c/p\u003e\n\u003cp\u003eAbout the Lua documentation, i believe i can use the Angel Script documention. As stated somewhere in the documention, Lua and AngelScript have transitive functions implementation. So i guess i can use \u003ca href=\"https://urho3d.github.io/documentation/1.4/_script_a_p_i.html\" rel=\"nofollow noopener\"\u003ethis reference\u003c/a\u003e with trust.\u003c/p\u003e\n\u003cp\u003eThank you for reading,\u003cbr\u003e\nZakk.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-09-24T13:21:29.425Z","reply_count":0,"reply_to_post_number":5,"quote_count":0,"incoming_link_count":0,"reads":22,"readers_count":21,"score":4.4,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://urho3d.github.io/documentation/1.4/_script_a_p_i.html","internal":false,"reflection":false,"title":"Urho3D - Documentation","clicks":1},{"url":"https://urho3d.github.io/documentation/HEAD/_event_list.html","internal":false,"reflection":false,"title":"Urho3D - Documentation - Event list","clicks":0}],"read":true,"user_title":null,"reply_to_user":{"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":116,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20951,"name":"Yao Wei Tjong","username":"weitjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","created_at":"2017-09-24T13:33:50.350Z","cooked":"\u003cp\u003eWe also have generated page for Lua scripting API. \u003ca href=\"https://urho3d.github.io/documentation/HEAD/_lua_script_a_p_i.html\"\u003ehttps://urho3d.github.io/documentation/HEAD/_lua_script_a_p_i.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAlso, note the document version on the top right corner of the documentation page. You may want to switch to the version you are currently using or HEAD when you are tracking the master branch.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-09-24T13:33:50.350Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":21,"readers_count":20,"score":34.2,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"Yao Wei Tjong","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://urho3d.github.io/documentation/HEAD/_lua_script_a_p_i.html","internal":false,"reflection":false,"title":"Urho3D - Documentation - Lua scripting API","clicks":3}],"read":true,"user_title":"Admin","title_is_group":false,"bookmarked":false,"actions_summary":[{"id":2,"count":2}],"moderator":false,"admin":true,"staff":true,"user_id":4,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20956,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2017-09-24T16:29:39.471Z","cooked":"\u003cp\u003eA Variant isn‚Äôt necessarily a basic Urho3D object, so much as it is a sort of catch-all datatype that can \u003cem\u003ehold\u003c/em\u003e basic Urho3D objects. In a way, Variants are redundant for Lua, since in Lua, which is dynamically typed, any variable or reference or table member can hold any type, be it a string, a number, a function, or whatever. Such things are not possible in native C++, without using an intermediary such as Variant.\u003c/p\u003e\n\u003cp\u003eConsider the Lua code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003elocal thingy=4.0\nthingy=\"thingy\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn Lua, that is no big deal. Happens all the time. thingy is not declared with any particular type, because it‚Äôs not necessary to do so. However, in C++, you need to declare your thingy with a particular type:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efloat thingy=4.0;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can‚Äôt then override thingy with a string type:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ethingy=\"thingy\";   // Doesn't work in C++\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSince C++ is statically typed, you can‚Äôt just assign different types of values to a variable willy-nilly. Most of the time, that‚Äôs not an issue. However, one case in which it is nice to be able to do so is in ad-hoc message passing schemes.\u003c/p\u003e\n\u003cp\u003eIn message passing, you have a centralized dispatcher that sends messages from objects to other objects. What, exactly, the content of these messages is is irrelevant. It just takes a message from object A and sends it to object B, and lets B worry about what the message content is. In order to facilitate such a system, you need a data type that can hold an object of any other data type. In order for the body of the message to be generic and flexible, you need an \u003cem\u003eany\u003c/em\u003e data type. So that object A could send the message {type=‚ÄúReduceHitPoints‚Äù, damage=14} to object B, while object B sends the message {type=‚ÄúImDead‚Äù, whokilledme=objectA} to object C, and the message-passing infrastructure doesn‚Äôt need to know the particulars of these messages. You don‚Äôt need to come up with dozens of different message structures to facilitate each one; you can just populate a VariantMap with the various data that particular message needs and send it along.\u003c/p\u003e\n\u003cp\u003eIt‚Äôs a lot like simply populating a Lua table with the various data you need and sending it along. Same principle, it‚Äôs just that Lua was designed from the start to be dynamically typed, while C++ was not. Variant and VariantMap (along with VariantVector) provide a certain amount of dynamic typing to facilitate the passing of ad hoc messages. And even in Lua, since you are interacting with the C++ library, you need to use Variant and VariantMap to pass your messages, since the C++ code expects it. Think of them as a kinda more convoluted Lua table, addressable by string keys, and you‚Äôll be fine.\u003c/p\u003e\n\u003cp\u003eThis touches on your desire to have two tables for eventType and eventData, rather than userdata. Lua would be fine with two tables, but since the C++ engine code doesn‚Äôt know what to do with a Lua table, it expects instead a StringHash and a VariantMap. It would be valid to construct the binding such that on the Lua side of things you create a Lua table, and when it is passed to a function expecting a VariantMap it is converted behind-the-scenes. However, that is not the way these bindings were constructed. Doing it the way it does it now keeps the interface and usages similar among Lua, AngelScript and C++. In each case, you construct a VariantMap and populate it with data; doing it \u003cem\u003edifferently\u003c/em\u003e in Lua alone would break the paradigm and make it more difficult to maintain the bindings, I think.\u003c/p\u003e\n\u003cp\u003eIn the case of my example with SetPixel, the problematic part of that line is the Color(1,1,1,1) that is passed to SetPixel. This constructs a garbage-collected instance of the Color class and passes it. Since it‚Äôs garbage-collected (ie, its lifetime is managed by the Lua garbage collector) then it is stashed in an internal table until it is garbage collected. In an inner loop like that, you can end up creating thousands of such objects which cause the table to explode in size. When they are all garbage collected, that internal table isn‚Äôt resized to a smaller size, causing a performance drain when looking for other objects to collect.\u003c/p\u003e\n\u003cp\u003eIn addition to the Lua script API page that \u003ca class=\"mention\" href=\"/u/weitjong\"\u003e@weitjong\u003c/a\u003e pointed out, I find great value in looking at the .pkg files used by tolua++ to generate the binding code, located in Urho3D/Source/Urho3D/LuaScript/pkgs to see exactly how the bindings are structured and what they require.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-09-24T16:29:39.471Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":19,"readers_count":18,"score":18.8,"yours":false,"topic_id":3600,"topic_slug":"urho3dplayer-lua-initialize","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[20931,20932,20933,20934,20936,20949,20951,20956]},"timeline_lookup":[[1,1887],[4,1886]],"suggested_topics":[{"id":7185,"title":"Update Ray ray direction","fancy_title":"Update Ray ray direction","slug":"update-ray-ray-direction","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-02-05T00:28:45.414Z","last_posted_at":"2022-02-05T20:19:51.238Z","bumped":true,"bumped_at":"2022-02-05T20:19:51.238Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":144,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7092,"title":"Finding the World Space Coordinates of the Screen Edges","fancy_title":"Finding the World Space Coordinates of the Screen Edges","slug":"finding-the-world-space-coordinates-of-the-screen-edges","posts_count":6,"reply_count":2,"highest_post_number":6,"image_url":null,"created_at":"2021-12-07T20:53:49.453Z","last_posted_at":"2021-12-08T12:33:52.510Z","bumped":true,"bumped_at":"2021-12-08T12:33:52.510Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":210,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]},{"id":7127,"title":"Switching ribbon trails emission glitches transparent materials","fancy_title":"Switching ribbon trails emission glitches transparent materials","slug":"switching-ribbon-trails-emission-glitches-transparent-materials","posts_count":8,"reply_count":3,"highest_post_number":8,"image_url":null,"created_at":"2022-01-13T17:17:46.847Z","last_posted_at":"2022-02-10T08:10:49.330Z","bumped":true,"bumped_at":"2022-02-10T08:10:49.330Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":323,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1188,"username":"Taqer","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}}]},{"id":7098,"title":"Cartoon Fire Effect","fancy_title":"Cartoon Fire Effect","slug":"cartoon-fire-effect","posts_count":6,"reply_count":0,"highest_post_number":6,"image_url":null,"created_at":"2021-12-10T04:08:49.887Z","last_posted_at":"2021-12-12T02:49:51.076Z","bumped":true,"bumped_at":"2021-12-12T02:49:51.076Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":274,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7193,"title":"Can Z-Axis Feasibly be \"Up\"?","fancy_title":"Can Z-Axis Feasibly be \u0026ldquo;Up\u0026rdquo;?","slug":"can-z-axis-feasibly-be-up","posts_count":4,"reply_count":2,"highest_post_number":4,"image_url":null,"created_at":"2022-02-14T05:17:28.054Z","last_posted_at":"2022-02-14T07:26:53.817Z","bumped":true,"bumped_at":"2022-02-14T07:26:53.817Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":161,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]}],"tags_descriptions":{},"id":3600,"title":"[Urho3DPlayer , Lua] Initialize()","fancy_title":"[Urho3DPlayer , Lua] Initialize()","posts_count":8,"created_at":"2017-09-23T15:23:36.129Z","views":684,"reply_count":3,"like_count":5,"last_posted_at":"2017-09-24T16:29:39.471Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"urho3dplayer-lua-initialize","category_id":10,"word_count":2592,"deleted_at":null,"user_id":116,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_3600","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":8,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":4,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"accepted_answer":{"post_number":5,"username":"JTippetts","excerpt":"Initialize is a method in the Engine class. It‚Äôs just a huge pile of boilerplate code, and nothing in there is controllable directly from the Lua scripting system, or really concerns the Lua system in any direct way. Various defaults, such as default renderpath, are set (not directly from Initialize\u0026hellip;"},"details":{"can_edit":false,"notification_level":1,"participants":[{"id":116,"username":"zakk","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/zakk/{size}/871_2.png","post_count":3,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":4}],"created_by":{"id":116,"username":"zakk","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/zakk/{size}/871_2.png"},"last_poster":{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png"},"links":[{"url":"https://urho3d.github.io/documentation/1.4/_main_loop.html","title":"Urho3D - Documentation","internal":false,"attachment":false,"reflection":false,"clicks":7,"user_id":116,"domain":"urho3d.github.io","root_domain":"urho3d.github.io"},{"url":"https://urho3d.github.io/documentation/1.4/class_urho3_d_1_1_engine.html","title":"Urho3D - Documentation","internal":false,"attachment":false,"reflection":false,"clicks":4,"user_id":116,"domain":"urho3d.github.io","root_domain":"urho3d.github.io"},{"url":"https://urho3d.github.io/documentation/HEAD/_lua_script_a_p_i.html","title":"Urho3D - Documentation - Lua scripting API","internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":4,"domain":"urho3d.github.io","root_domain":"urho3d.github.io"},{"url":"https://urho3d.github.io/documentation/HEAD/_running.html","title":"Urho3D - Documentation - Running Urho3D player application","internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":484,"domain":"urho3d.github.io","root_domain":"urho3d.github.io"},{"url":"https://urho3d.github.io/documentation/1.4/_script_a_p_i.html","title":"Urho3D - Documentation","internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":116,"domain":"urho3d.github.io","root_domain":"urho3d.github.io"}]}}