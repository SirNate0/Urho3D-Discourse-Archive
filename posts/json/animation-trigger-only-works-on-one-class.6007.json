{"post_stream":{"posts":[{"id":36828,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T00:57:05.474Z","cooked":"\u003cp\u003eSo this may seem odd. I tried to give my AI class an animation trigger for movements and such, but for some reason their animation trigger fires on my Character class. So for example my AI class has an animation sound trigger for their footsteps which is a completely different sound for testing purposes. When they move nothing happens. When my character moves it plays their sound. I think I made a mistake in my class somewhere, but not to sure.\u003c/p\u003e\n\u003cp\u003eAIMelee.h\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#pragma once\n\n#include \u0026lt;Urho3D/Input/Controls.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/LogicComponent.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/SoundSource3D.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/Sound.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/AudioEvents.h\u0026gt;\n\nusing namespace Urho3D;\n\n/// Character component, responsible for physical movement according to controls, as well as animation.\nclass AIMelee : public LogicComponent\n{\n\tURHO3D_OBJECT(AIMelee, LogicComponent);\n\npublic:\n\t/// Construct.\n\tAIMelee(Context* context):\n\tLogicComponent(context),\n\telapsedTime_(0.0f)\n\t{\n\t\tSetUpdateEventMask(USE_FIXEDUPDATE);\n\t\tSetUpdateEventMask(USE_UPDATE);\n\t}\n\n\n\t/// Register object factory and attributes.\n\tstatic void RegisterObject(Context* context);\n\n\t/// Handle startup. Called by LogicComponent base class.\n\tvirtual void Start();\n\n\tvirtual void DelayedStart();\n\n\t/// Handle physics world update. Called by LogicComponent base class.\n\tvirtual void FixedUpdate(float timestep);\n\n\tvirtual void Update(float timestep);\n\n\tvirtual void PlaySound(const String\u0026amp; soundName);\n\n\tvirtual void HandleAnimationTriggerZombie(StringHash eventType, VariantMap\u0026amp; eventData);\n\n\tvirtual void loadResources();\n\n\tvirtual void bigHead(StringHash eventType, VariantMap\u0026amp; eventData);\n\n\tvirtual void melee(StringHash eventType, VariantMap\u0026amp; eventData);\n\n\tvirtual void setHealth(int h)\n\t{\n\t\thealth = h;\n\t}\n\n\tint getHealth()\n\t{\n\t\treturn health;\n\t}\n\tvirtual void setDeath(bool d)\n\t{\n\t\tdead_ = d;\n\t}\n\n\tbool getDeath()\n\t{\n\t\treturn dead_;\n\t}\n\n\t/// Movement controls. Assigned by the main program each frame.\n\tControls controls_;\n\n\tSoundSource3D* soundSrc;\n\tResourceCache* cache;\n\tAnimationController* idle;\n\tSharedPtr\u0026lt;Node\u0026gt; handboneNode;\n\tWeakPtr\u0026lt;Scene\u0026gt; scene_;\n\tDebugRenderer* debug;\n\tAnimatedModel* swordObject;\n\nprivate:\n\t/// Handle physics collision event.\n\tvoid HandleNodeCollision(StringHash eventType, VariantMap\u0026amp; eventData);\n\n\t/// Grounded flag for movement.\n\tbool onGround_;\n\t/// Grounded flag for movement.\n\tbool dead_ = false;\n\t/// Jump flag.\n\tbool okToJump_;\n\t/// In air timer. Due to possible physics inaccuracy, character can be off ground for max. 1/10 second and still be allowed to move.\n\tfloat inAirTimer_;\n\t/// elapsed time\n\tfloat elapsedTime_;\n\n\tint health;\n\tSharedPtr\u0026lt;Node\u0026gt; head;\n\tRigidBody* body;\n\tCollisionShape* shape;\n\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAIMelee.cpp\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e    // std::cout\u003cbr\u003e\n\u003cspan class=\"hashtag\"\u003e#include\u003c/span\u003e \u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#include \u0026lt;Urho3D/Core/CoreEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Core/Context.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/AnimationController.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/AnimatedModel.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/DrawableEvents.h\u0026gt;\n#include \u0026lt;Urho3D/IO/MemoryBuffer.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/PhysicsEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/PhysicsWorld.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/RigidBody.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/CollisionShape.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/Scene.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/SceneEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Input/Input.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/Sound.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/SoundSource3D.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/SoundListener.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/AudioEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Resource/ResourceCache.h\u0026gt;\n#include \u0026lt;Urho3D/Navigation/CrowdAgent.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/DebugRenderer.h\u0026gt;\n#include \u0026lt;Urho3D/IO/Log.h\u0026gt;\n\n#include \"AIMelee.h\"\n\nvoid AIMelee::RegisterObject(Context* context)\n{\n\tcontext-\u0026gt;RegisterFactory\u0026lt;AIMelee\u0026gt;();\n}\n\nvoid AIMelee::Start()\n{\n\tloadResources();\n\t// Component has been inserted into its scene node. Subscribe to events now\n\tSubscribeToEvent(E_NODECOLLISION, URHO3D_HANDLER(AIMelee, HandleNodeCollision));\n}\n\nvoid AIMelee::DelayedStart()\n{\n\tSubscribeToEvent(E_ANIMATIONTRIGGER, URHO3D_HANDLER(AIMelee, HandleAnimationTriggerZombie));\n\tSubscribeToEvent(E_POSTRENDERUPDATE, URHO3D_HANDLER(AIMelee, bigHead));\n\n}\n\nvoid AIMelee::FixedUpdate(float timeStep)\n{\n}\n\n/// Handle scene update. Called by LogicComponent base class.\nvoid AIMelee::Update(float timeStep)\n{\n\tCrowdAgent* agent = node_-\u0026gt;GetComponent\u0026lt;CrowdAgent\u0026gt;();\n\n\tif (health \u0026lt;= 0 \u0026amp;\u0026amp; dead_ == false)\n\t{\n\t\tPlaySound(\"Sounds/death_mjr.ogg\");\n\t\tidle-\u0026gt;PlayExclusive(\"Models/combat_landing_dead.ani\", 0, false, 0.5f); // Try tweaking the last value.\n\n\t\tif (node_-\u0026gt;HasComponent\u0026lt;CrowdAgent\u0026gt;())\n\t\t{\n\t\t\tagent-\u0026gt;Remove();\n\t\t}\n\t\tshape-\u0026gt;SetCapsule(15.0f, 5.0f, Vector3(0.0f, 5.0f, 0.0f));\n\t\tbody-\u0026gt;SetMass(1000000.0f);\n\t\tdead_ = true;\n\t}\n\n\tfloat duration_ = 2.5f;\n\telapsedTime_ += timeStep;\n\n\tif (dead_ == true)\n\t{\n\t\t// Disappear when duration expired\n\t\tif (duration_ \u0026gt;= 0)\n\t\t{\n\t\t\tduration_ -= timeStep;\n\t\t\tif (duration_ \u0026lt;= 0)\n\t\t\t{\n\t\t\t\tnode_-\u0026gt;Remove();\n\t\t\t}\n\t\t}\n\t}\n\n\treturn;\n}\n\nvoid AIMelee::loadResources()\n{\n\tcache = GetSubsystem\u0026lt;ResourceCache\u0026gt;();\n\n\t// Create the rendering component + animation controller\n\tAnimatedModel* object = node_-\u0026gt;CreateComponent\u0026lt;AnimatedModel\u0026gt;();\n\tobject-\u0026gt;SetModel(cache-\u0026gt;GetResource\u0026lt;Model\u0026gt;(\"Models/masterchief.mdl\"));\n\tobject-\u0026gt;ApplyMaterialList(\"Materials/zombie.txt\");\n\tobject-\u0026gt;SetOccludee(true);\n\n\tidle = node_-\u0026gt;CreateComponent\u0026lt;AnimationController\u0026gt;();\n\n\thandboneNode = node_-\u0026gt;GetChild(\"right_hand_marker\", true);\n\n\tswordObject = handboneNode-\u0026gt;CreateComponent\u0026lt;AnimatedModel\u0026gt;();\n\tswordObject-\u0026gt;SetModel(cache-\u0026gt;GetResource\u0026lt;Model\u0026gt;(\"Models/plasma_sword.mdl\"));\n\tswordObject-\u0026gt;ApplyMaterialList(\"Materials/plasma_sword.txt\");\n\n\t// Create rigid body, and set non-zero mass so that the body becomes dynamic\n\tbody = node_-\u0026gt;CreateComponent\u0026lt;RigidBody\u0026gt;();\n\tbody-\u0026gt;SetCollisionLayer(1);\n\tbody-\u0026gt;SetMass(1.0f);\n\n\t// Set zero angular factor so that physics doesn't turn the character on its own.\n\t// Instead we will control the character yaw manually\n\tbody-\u0026gt;SetAngularFactor(Vector3::ZERO);\n\n\t// Set the rigid body to signal collision also when in rest, so that we get ground collisions properly\n\tbody-\u0026gt;SetCollisionEventMode(COLLISION_ALWAYS);\n\n\t// Set a capsule shape for collision\n\tshape = node_-\u0026gt;CreateComponent\u0026lt;CollisionShape\u0026gt;();\n\tshape-\u0026gt;SetCapsule(40.0f, 70.0f, Vector3(0.0f, 35.0f, 0.0f));\n\n\t// Create a CrowdAgent component and set its height and realistic max speed/acceleration. Use default radius\n\tauto* agent = node_-\u0026gt;CreateComponent\u0026lt;CrowdAgent\u0026gt;();\n\tagent-\u0026gt;SetHeight(1.0f);\n\tagent-\u0026gt;SetMaxSpeed(9.0f);\n\tagent-\u0026gt;SetMaxAccel(9.0f);\n\n\n\n\n}\n\nvoid AIMelee::bigHead(StringHash eventType, VariantMap\u0026amp; eventData)\n{\n\thead = node_-\u0026gt;GetChild(\"head\", true);\n\thead-\u0026gt;SetScale(Vector3(2.5f, 2.5f, 2.5f));\n\n}\n\nvoid AIMelee::melee(StringHash eventType, VariantMap\u0026amp; eventData)\n{\n\tscene_ = node_-\u0026gt;GetScene();\n\tdebug = scene_-\u0026gt;GetComponent\u0026lt;DebugRenderer\u0026gt;();\n\n\tCollisionShape* shape_ = handboneNode-\u0026gt;CreateComponent\u0026lt;CollisionShape\u0026gt;();\n\tshape_-\u0026gt;SetCapsule(2.0f, 2.0f, Vector3::ZERO, Quaternion::IDENTITY);\n\n\tPhysicsRaycastResult raycResult;\n\tauto* physicsWorld = scene_-\u0026gt;GetComponent\u0026lt;PhysicsWorld\u0026gt;();\n\n\tconst Vector3 start = handboneNode-\u0026gt;GetWorldPosition();\n\tconst Vector3 end = start + (Vector3::FORWARD * 100.0f);\n\n\tphysicsWorld-\u0026gt;ConvexCast(raycResult, shape_, start, Quaternion::IDENTITY, end, Quaternion::IDENTITY);\n\n\tdebug-\u0026gt;AddCylinder(handboneNode-\u0026gt;GetWorldPosition(), 0.025f, 0.025f, Color::RED, false);\n\n\tRigidBody* resultBody{ raycResult.body_ };\n\tAIMelee* _Node;\n\tint damage = 100;\n\n\tif (resultBody)\n\t{\n\n\t\tNode* resultNode{ resultBody-\u0026gt;GetNode() };\n\n\t\tif (_Node = resultNode-\u0026gt;GetDerivedComponent\u0026lt;AIMelee\u0026gt;())\n\t\t{\n\t\t\t_Node-\u0026gt;setHealth(_Node-\u0026gt;getHealth() - damage);\n\t\t\tresultBody-\u0026gt;ApplyImpulse(Vector3(1.0f, 1.0f, 1.0f)* 1.0f);\n\t\t}\n\n\t}\n}\n\nvoid AIMelee::HandleNodeCollision(StringHash eventType, VariantMap\u0026amp; eventData)\n{\n\t// Check collision contacts and see if character is standing on ground (look for a contact that has near vertical normal)\n\tusing namespace NodeCollision;\n\n\tRigidBody* body = node_-\u0026gt;GetComponent\u0026lt;RigidBody\u0026gt;(true);\n\n\tMemoryBuffer contacts(eventData[P_CONTACTS].GetBuffer());\n\n\twhile (!contacts.IsEof())\n\t{\n\t\tVector3 contactPosition = contacts.ReadVector3();\n\t\tVector3 contactNormal = contacts.ReadVector3();\n\t\t/*float contactDistance = */contacts.ReadFloat();\n\t\t/*float contactImpulse = */contacts.ReadFloat();\n\n\t\t// If contact is below node center and pointing up, assume it's a ground contact\n\t\tif (contactPosition.y_ \u0026lt; (node_-\u0026gt;GetPosition().y_ + 1.0f))\n\t\t{\n\t\t\tfloat level = contactNormal.y_;\n\t\t\tif (level \u0026gt; 0.75)\n\t\t\t\tonGround_ = true;\n\t\t}\n\t}\n}\n\nvoid AIMelee::PlaySound(const String\u0026amp; soundName)\n{\n\tResourceCache* cache = GetSubsystem\u0026lt;ResourceCache\u0026gt;();\n\n\tSound* sound = cache-\u0026gt;GetResource\u0026lt;Sound\u0026gt;(soundName);\n\n\tsoundSrc = node_-\u0026gt;CreateComponent\u0026lt;SoundSource3D\u0026gt;();\n\tsoundSrc-\u0026gt;SetNearDistance(5.0f);\n\tsoundSrc-\u0026gt;SetFarDistance(15.0f);\n\tsoundSrc-\u0026gt;SetGain(1.0f);\n\tsoundSrc-\u0026gt;SetSoundType(SOUND_EFFECT);  // optional\n\tsoundSrc-\u0026gt;Play(sound);\n\tsoundSrc-\u0026gt;SetAutoRemoveMode(REMOVE_COMPONENT);\n}\n\nvoid AIMelee::HandleAnimationTriggerZombie(StringHash eventType, VariantMap\u0026amp; eventData)\n{\n\tusing namespace AnimationTrigger;\n\tAnimatedModel* model = node_-\u0026gt;GetComponent\u0026lt;AnimatedModel\u0026gt;();\n\tif (model)\n\t{\n\t\tAnimationState* state = model-\u0026gt;GetAnimationState(eventData[P_NAME].GetString());\n\t\tif (state == NULL)\n\t\t\treturn;\n\n\n\t\tNode* bone = node_-\u0026gt;GetChild(eventData[P_DATA].GetString(), true);\n\n\t\tURHO3D_LOGDEBUG(\"Made it!\");\n\n\t\tif (bone != NULL)\n\t\t\tPlaySound(\"Sounds/NutThrow.wav\");\n\n\t}\n\n}\u003c/code\u003e\u003c/pre\u003e","post_number":1,"post_type":1,"updated_at":"2020-03-20T05:17:27.733Z","reply_count":3,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":3,"reads":28,"readers_count":27,"score":35.4,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36830,"name":"SirNate0","username":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","created_at":"2020-03-20T03:42:10.285Z","cooked":"\u003caside class=\"quote no-group quote-modified\" data-username=\"GodMan\" data-post=\"1\" data-topic=\"6007\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/40.png\" class=\"avatar\"\u003e GodMan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eSubscribeToEvent(E_ANIMATIONTRIGGER, URHO3D_HANDLER(AIMelee, HandleAnimationTriggerZombie)); \nSubscribeToEvent(E_POSTRENDERUPDATE, URHO3D_HANDLER(AIMelee, bigHead)); \nSubscribeToEvent(E_ANIMATIONTRIGGER, URHO3D_HANDLER(AIMelee, melee)); \n\u003c/code\u003e\u003c/pre\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eDid you mean to subscribe to the animation trigger event for both \u003ccode\u003eHandleAnimationTriggerZombie\u003c/code\u003e and \u003ccode\u003emelee\u003c/code\u003e?\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2020-03-20T03:42:10.285Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":22,"readers_count":21,"score":4.2,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"SirNate0","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":628,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36833,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T05:16:52.538Z","cooked":"\u003cp\u003eNo. I was testing I removed the melee. I‚Äôll edit the post. Unfortunately it did not fix anything. I wonder if it has anything do with the models being the same. My character and NPC are the same 3d model just a palette swap. I would not think this would be the issue though.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2020-03-20T05:16:52.538Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":22,"readers_count":21,"score":9.2,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36845,"name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","username":"Modanung","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png","created_at":"2020-03-20T08:44:30.722Z","cooked":"\u003cp\u003eI think \u003ccode\u003ebone\u003c/code\u003e may be null. Could you add a check within the if-statement to be sure it doesn‚Äôt fail? Or an \u003ccode\u003eassert(bone)\u003c/code\u003e instead of the logging line.\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"GodMan\" data-post=\"1\" data-topic=\"6007\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/40.png\" class=\"avatar\"\u003e GodMan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eNode* bone = node_-\u0026gt;GetChild(eventData[P_DATA].GetString(), true); \n\nURHO3D_LOGDEBUG(\"Made it!\");\n\nif (bone != NULL)\n    PlaySound(\"Sounds/NutThrow.wav\");\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eYou could probably also reuse some code by making \u003ccode\u003eAIMelee\u003c/code\u003e inherit from \u003ccode\u003eCharacter\u003c/code\u003e.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2020-03-20T08:47:49.409Z","reply_count":1,"reply_to_post_number":3,"quote_count":1,"incoming_link_count":0,"reads":22,"readers_count":21,"score":9.2,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":192,"hidden":false,"trust_level":0,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"user_suspended":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36851,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T17:15:17.018Z","cooked":"\u003cp\u003ebone is not returning NULL. It evens shows that the sound loads when the animation trigger fires.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\tif (bone != NULL)\n\t{\n\t\tif (bone == NULL)\n\t\t{\n\t\t\tURHO3D_LOGDEBUG(\"Bone is null\");\n\t\t}\n\n\t\tPlaySound(\"Sounds/NutThrow.wav\");\n\t}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI‚Äôm starting to think maybe my 3D Sound setup has a mistake. Is my PlaySound setup correct? I‚Äôm trying to tie a 3d sound to my NPC, and have the sound attenuation from their locations. Maybe their is a problem with a listener node or something. I used the wiki and ninja snow wars, but they both do it differently.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2020-03-20T18:17:24.919Z","reply_count":1,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":0,"reads":17,"readers_count":16,"score":8.4,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36854,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T18:01:24.578Z","cooked":"\u003cp\u003eSo I did some more testing. I removed the event in the Character class, for the animation trigger. I only left the one above. Strangely it still plays the animation trigger from the NPC‚Äôs class. I verified that my player node has the separate class Character only, and the NPC‚Äôs have the AIMelee class, but for some reason the player keeps using their animation trigger.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2020-03-20T18:01:24.578Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":16,"readers_count":15,"score":3.2,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36855,"name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","username":"Modanung","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png","created_at":"2020-03-20T18:12:24.492Z","cooked":"\u003cp\u003eNow the assertion is redundant.\u003cbr\u003e\nDon‚Äôt forget to wrap the body of your if-statement in accolades‚Ä¶ and don‚Äôt lose your head. \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/wink.png?v=9\" title=\":wink:\" class=\"emoji\" alt=\":wink:\"\u003e\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2020-03-20T18:14:22.365Z","reply_count":0,"reply_to_post_number":5,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":3.0,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":192,"hidden":false,"trust_level":0,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"user_suspended":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36856,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T18:14:42.652Z","cooked":"\u003cp\u003eOkay. I just can‚Äôt figure this out. I just don‚Äôt see how the character class is using another classes animation trigger.\u003c/p\u003e\n\u003cp\u003eEDIT: Fixed above post.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2020-03-20T18:17:41.082Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":3.0,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36857,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2020-03-20T18:20:09.921Z","cooked":"\u003cp\u003eCan you post the source for your Character class? It seems likely that is where the problem lies.\u003c/p\u003e\n\u003cp\u003eEdit: Also note that if you subscribe to events in this manner:\u003c/p\u003e\n\u003cp\u003eSubscribeToEvent(E_ANIMATIONTRIGGER, URHO3D_HANDLER(AIMelee, melee));\u003c/p\u003e\n\u003cp\u003eyou are subscribing to receive all animation triggers, originating from all sources that raise an animation trigger event. If you want to tighten down control, you need to register to only receive animation triggers from a specific (ie, the player or AI) node or controller.\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2020-03-20T18:23:01.834Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":16,"readers_count":15,"score":18.2,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36860,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T18:45:34.187Z","cooked":"\u003cpre\u003e\u003ccode\u003e#pragma once //Character.h \n\n#include \u0026lt;Urho3D/Input/Controls.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/LogicComponent.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/SoundSource3D.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/Sound.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/AudioEvents.h\u0026gt;\n\nusing namespace Urho3D;\n\nconst int CTRL_FORWARD = 1;\nconst int CTRL_BACK = 2;\nconst int CTRL_LEFT = 4;\nconst int CTRL_RIGHT = 8;\nconst int CTRL_JUMP = 16;\nconst int CTRL_MELEE = 32;\nconst int CTRL_CROUCH = 64;\n\nconst float MOVE_FORCE = 0.8f;\nconst float INAIR_MOVE_FORCE = 0.05f;\nconst float BRAKE_FORCE = 0.2f;\nconst float JUMP_FORCE = 7.0f;\nconst float YAW_SENSITIVITY = 0.1f;\nconst float INAIR_THRESHOLD_TIME = 0.1f;\n\nconst int LAYER_MOVE = 0;\nconst int LAYER_ATTACK = 1;\n\n/// Character component, responsible for physical movement according to controls, as well as animation.\nclass Character : public LogicComponent\n{\n    URHO3D_OBJECT(Character, LogicComponent);\n\npublic:\n    /// Construct.\n    Character(Context* context);\n    \n    /// Register object factory and attributes.\n    static void RegisterObject(Context* context);\n    \n    /// Handle startup. Called by LogicComponent base class.\n    virtual void Start();\n\n\tvirtual void DelayedStart();\n\n    /// Handle physics world update. Called by LogicComponent base class.\n    virtual void FixedUpdate(float timeStep);\n\n\tvirtual void PlaySound(const String\u0026amp; soundName);\n\n\tvirtual void HandleAnimationTrigger(StringHash eventType, VariantMap\u0026amp; eventData);\n\n\tvirtual void setHealth(int h)\n\t{\n\t\thealth = h;\n\t}\n\n\tint getHealth()\n\t{\n\t\treturn health;\n\t}\n\tvirtual void setDeath(bool d)\n\t{\n\t\tdead_ = d;\n\t}\n\n\tbool getDeath()\n\t{\n\t\treturn dead_;\n\t}\n    \n    /// Movement controls. Assigned by the main program each frame.\n    Controls controls_;\n\n\tSoundSource* sound_source;\n    \nprivate:\n    /// Handle physics collision event.\n    void HandleNodeCollision(StringHash eventType, VariantMap\u0026amp; eventData);\n    \n    /// Grounded flag for movement.\n    bool onGround_;\n\t/// Grounded flag for movement.\n\tbool dead_ = false;\n    /// Jump flag.\n    bool okToJump_;\n    /// In air timer. Due to possible physics inaccuracy, character can be off ground for max. 1/10 second and still be allowed to move.\n    float inAirTimer_;\n\n\tint health;\n\t\n};\n\n\n\n\n\n//\n// Copyright (c) 2008-2017 the Urho3D project.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n//\n\n#include \u0026lt;Urho3D/Core/Context.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/AnimationController.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/AnimatedModel.h\u0026gt;\n#include \u0026lt;Urho3D/Graphics/DrawableEvents.h\u0026gt;\n#include \u0026lt;Urho3D/IO/MemoryBuffer.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/PhysicsEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/PhysicsWorld.h\u0026gt;\n#include \u0026lt;Urho3D/Physics/RigidBody.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/Scene.h\u0026gt;\n#include \u0026lt;Urho3D/Scene/SceneEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Input/Input.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/SoundSource3D.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/Sound.h\u0026gt;\n#include \u0026lt;Urho3D/Audio/AudioEvents.h\u0026gt;\n#include \u0026lt;Urho3D/Resource/ResourceCache.h\u0026gt;\n#include \u0026lt;Urho3D/Navigation/CrowdAgent.h\u0026gt;\n\n#include \"Character.h\"\n\nCharacter::Character(Context* context) :\n    LogicComponent(context),\n    onGround_(false),\n    okToJump_(true),\n    inAirTimer_(0.0f)\n{\n    // Only the physics update event is needed: un-subscribe from the rest for optimization\n    SetUpdateEventMask(USE_FIXEDUPDATE);\n}\n\nvoid Character::RegisterObject(Context* context)\n{\n    context-\u0026gt;RegisterFactory\u0026lt;Character\u0026gt;();\n\n    // These macros register the class attributes to the Context for automatic load / save handling.\n    // We specify the Default attribute mode which means it will be used both for saving into file, and network replication\n    URHO3D_ATTRIBUTE(\"Controls Yaw\", float, controls_.yaw_, 0.0f, AM_DEFAULT);\n    URHO3D_ATTRIBUTE(\"Controls Pitch\", float, controls_.pitch_, 0.0f, AM_DEFAULT);\n    URHO3D_ATTRIBUTE(\"On Ground\", bool, onGround_, false, AM_DEFAULT);\n    URHO3D_ATTRIBUTE(\"OK To Jump\", bool, okToJump_, true, AM_DEFAULT);\n    URHO3D_ATTRIBUTE(\"In Air Timer\", float, inAirTimer_, 0.0f, AM_DEFAULT);\n}\n\nvoid Character::Start()\n{\n    // Component has been inserted into its scene node. Subscribe to events now\n    SubscribeToEvent(GetNode(), E_NODECOLLISION, URHO3D_HANDLER(Character, HandleNodeCollision));\n}\n\nvoid Character::DelayedStart()\n{\n\t//SubscribeToEvent(GetNode()-\u0026gt;GetChild(\"AdjNode\", true), E_ANIMATIONTRIGGER, URHO3D_HANDLER(Character, HandleAnimationTrigger));\n\n}\n\nvoid Character::FixedUpdate(float timeStep)\n{\n\n    /// \\todo Could cache the components for faster access instead of finding them each frame\n    RigidBody* body = GetComponent\u0026lt;RigidBody\u0026gt;();\n    AnimationController* animCtrl = node_-\u0026gt;GetComponent\u0026lt;AnimationController\u0026gt;(true);\n\tInput* input = GetSubsystem\u0026lt;Input\u0026gt;();\n\tCrowdAgent* agent = node_-\u0026gt;GetComponent\u0026lt;CrowdAgent\u0026gt;(true);\n\n    // Update the in air timer. Reset if grounded\n    if (!onGround_)\n        inAirTimer_ += timeStep;\n    else\n        inAirTimer_ = 0.0f;\n    // When character has been in air less than 1/10 second, it's still interpreted as being on ground\n    bool softGrounded = inAirTimer_ \u0026lt; INAIR_THRESHOLD_TIME;\n\n    // Update movement \u0026amp; animation\n    const Quaternion\u0026amp; rot = node_-\u0026gt;GetRotation();\n    Vector3 moveDir = Vector3::ZERO;\n    const Vector3\u0026amp; velocity = body-\u0026gt;GetLinearVelocity();\n    // Velocity on the XZ plane\n    Vector3 planeVelocity(velocity.x_ * 0.5f, 0.0f, velocity.z_ * 0.5f);\n\n    if (controls_.IsDown(CTRL_FORWARD))\n        moveDir += Vector3::FORWARD;\n    if (controls_.IsDown(CTRL_BACK))\n        moveDir += Vector3::BACK;\n    if (controls_.IsDown(CTRL_LEFT))\n        moveDir += Vector3::LEFT;\n    if (controls_.IsDown(CTRL_RIGHT))\n        moveDir += Vector3::RIGHT;\n\n\n    // Normalize move vector so that diagonal strafing is not faster\n    if (moveDir.LengthSquared() \u0026gt; 0.0f)\n        moveDir.Normalize();\n\n    // If in air, allow control, but slower than when on ground\n    body-\u0026gt;ApplyImpulse(rot * moveDir * (softGrounded ? MOVE_FORCE : INAIR_MOVE_FORCE));\n\n    if (softGrounded)\n    {\n        // When on ground, apply a braking force to limit maximum ground velocity\n        Vector3 brakeForce = -planeVelocity * BRAKE_FORCE;\n        body-\u0026gt;ApplyImpulse(brakeForce);\n\n        // Jump. Must release jump control between jumps\n        if (controls_.IsDown(CTRL_JUMP))\n        {\n            if (okToJump_)\n            {\n                body-\u0026gt;ApplyImpulse(Vector3::UP * JUMP_FORCE);\n                okToJump_ = false;\n\t\t\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/stand_sword_airborne.ani\", 0, false, 0.2f);\n            }\n        }\n        else\n            okToJump_ = true;\n    }\n\n\t// On air\n\tif (!onGround_) \n\t{\n\n\t\t// Falling a lot\n\t\tif (inAirTimer_ \u0026gt; 3.5f)\t\n\t\t{\t\t\n\t\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/combat_landing_dead.ani\", 0, true, 0.2f);\n\t\t\tstatic bool initialized;\n\t\t\tif (!initialized)\n\t\t\t{\n\t\t\t\tPlaySound(\"Sounds/death_mjr.ogg\");\n\t\t\t\tinitialized = true;\n\t\t\t\t\n\t\t\t}\n\t\t\t// Falling a bit\t\t\n\t\t}\n\t\telse \n\t\t{\n\t\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/stand_support_high_airborne.ani\", 0, true, 0.2f);\n\t\t\t\n\t\t}\n\n\t\t// On ground\n\t}\n\telse \n\t{\n\n\t\t// On ground with movement\n\t\tif (softGrounded \u0026amp;\u0026amp; !moveDir.Equals(Vector3::ZERO)) {\n\n\t\t\t// Moving forward\n\t\t\tif (softGrounded \u0026amp;\u0026amp; moveDir.Equals(Vector3::FORWARD)) {\n\t\t\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/combat_rifle_move_front.ani\", LAYER_MOVE, true, 0.2f);\n\t\t\t\tanimCtrl-\u0026gt;SetSpeed(\"Models/combat_rifle_move_front.ani\", planeVelocity.Length() * 0.3f);\n\t\t\t\tanimCtrl-\u0026gt;SetWeight(\"Models/combat_rifle_idle.ani\", 0.0f);\n\t\t\t}\n\n\t\t\t// Moving back\n\t\t\tif (softGrounded \u0026amp;\u0026amp; moveDir.Equals(Vector3::BACK)) {\n\t\t\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/stand_support_high_move_back.ani\", LAYER_MOVE, true, 0.2f);\n\t\t\t\tanimCtrl-\u0026gt;SetSpeed(\"Models/stand_support_high_move_back.ani\", planeVelocity.Length() * 0.3f);\n\t\t\t\tanimCtrl-\u0026gt;SetWeight(\"Models/combat_rifle_idle.ani\", 0.0f);\n\t\t\t}\n\n\t\t\t// Moving left\n\t\t\tif (softGrounded \u0026amp;\u0026amp; moveDir.Equals(Vector3::LEFT)) {\n\t\t\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/stand_support_high_move_left.ani\", LAYER_MOVE, true, 0.2f);\n\t\t\t\tanimCtrl-\u0026gt;SetSpeed(\"Models/stand_support_high_move_left.ani\", planeVelocity.Length() * 0.3f);\n\t\t\t\tanimCtrl-\u0026gt;SetWeight(\"Models/combat_rifle_idle.ani\", 0.0f);\n\t\t\t}\n\n\t\t\t// Moving right\n\t\t\tif (softGrounded \u0026amp;\u0026amp; moveDir.Equals(Vector3::RIGHT))\t{\n\t\t\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/stand_support_high_move_right.ani\", LAYER_MOVE, true, 0.2f);\n\t\t\t\tanimCtrl-\u0026gt;SetSpeed(\"Models/stand_support_high_move_right.ani\", planeVelocity.Length() * 0.3f);\n\t\t\t\tanimCtrl-\u0026gt;SetWeight(\"Models/combat_rifle_idle.ani\", 0.0f);\n\t\t\t}\n\n\t\t\t// On ground idle\n\t\t}\n\t\telse \n\t\t{\n\t\t\tanimCtrl-\u0026gt;SetStartBone(\"Models/combat_rifle_idle.ani\", \"spine1\");\n\t\t\tanimCtrl-\u0026gt;Play(\"Models/combat_rifle_idle.ani\", LAYER_ATTACK, true, 0.1f);\n\t\t\tanimCtrl-\u0026gt;SetWeight(\"Models/combat_rifle_idle.ani\", 0.99f);\n\t\t}\n\n\t}\n\n\tif (controls_.IsDown(CTRL_MELEE)) \n\t{\n\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/stand_sword_melee%1.ani\", LAYER_MOVE, false, 0.0f); // Try tweaking the last value.\n\t\tanimCtrl-\u0026gt;SetSpeed(\"Models/stand_sword_melee%1.ani\", 1.0f); // Try tweaking the last value.\n\t}\n\tif (controls_.IsDown(CTRL_CROUCH) \u0026amp;\u0026amp; softGrounded) \n\t{\n\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/crouch_rifle_idle.ani\", LAYER_MOVE, false, 0.25f); // Try tweaking the last value.\n\t\tanimCtrl-\u0026gt;SetSpeed(\"Models/crouch_rifle_idle.ani\", 0.5f); // Try tweaking the last value.\n\t}\n\n    // Reset grounded flag for next frame\n    onGround_ = false;\n\n\n\tif (health \u0026lt;= 0 \u0026amp;\u0026amp; dead_ == false \u0026amp;\u0026amp; softGrounded)\n\t{\n\t\tPlaySound(\"Sounds/death_mjr.ogg\");\n\t\tanimCtrl-\u0026gt;PlayExclusive(\"Models/combat_landing_dead.ani\", LAYER_MOVE, false, 0.0f); // Try tweaking the last value.\n\t\tanimCtrl-\u0026gt;StopAll(0);\n\n\t\tif (node_-\u0026gt;HasComponent\u0026lt;CrowdAgent\u0026gt;())\n\t\t{\n\t\t\tagent-\u0026gt;SetEnabled(false);\n\t\t}\n\t\t\n\t\tdead_ = true;\n\t\treturn;\n\t}\n\n}\n\nvoid Character::HandleNodeCollision(StringHash eventType, VariantMap\u0026amp; eventData)\n{\n    // Check collision contacts and see if character is standing on ground (look for a contact that has near vertical normal)\n    using namespace NodeCollision;\n\n\tRigidBody* body = node_-\u0026gt;GetComponent\u0026lt;RigidBody\u0026gt;(true);\n\n    MemoryBuffer contacts(eventData[P_CONTACTS].GetBuffer());\n\n    while (!contacts.IsEof())\n    {\n        Vector3 contactPosition = contacts.ReadVector3();\n        Vector3 contactNormal = contacts.ReadVector3();\n        /*float contactDistance = */contacts.ReadFloat();\n        /*float contactImpulse = */contacts.ReadFloat();\n\n        // If contact is below node center and pointing up, assume it's a ground contact\n        if (contactPosition.y_ \u0026lt; (node_-\u0026gt;GetPosition().y_ + 1.0f))\n        {\n            float level = contactNormal.y_;\n            if (level \u0026gt; 0.75)\n                onGround_ = true;\n        }\n    }\n}\n\nvoid Character::PlaySound(const String\u0026amp; soundName)\n{\n\tResourceCache* cache = GetSubsystem\u0026lt;ResourceCache\u0026gt;();\n\n\tSound* sound = cache-\u0026gt;GetResource\u0026lt;Sound\u0026gt;(soundName);\n\t// you can use an existing or a new node to append the sound to\n\tNode* node = node_-\u0026gt;CreateChild(\"SoundEffect\");\n\tsound_source = node-\u0026gt;CreateComponent\u0026lt;SoundSource\u0026gt;();\n\tsound_source-\u0026gt;SetSoundType(SOUND_EFFECT);  // optional\n\tsound_source-\u0026gt;SetGain(0.2f);\n\tsound_source-\u0026gt;Play(sound);\n\tsound_source-\u0026gt;SetAutoRemoveMode(REMOVE_COMPONENT);\n}\n\nvoid Character::HandleAnimationTrigger(StringHash eventType, VariantMap\u0026amp; eventData)\n{\n\tusing namespace AnimationTrigger;\n\tAnimatedModel* model = node_-\u0026gt;GetChild(\"AdjNode\", true)-\u0026gt;GetComponent\u0026lt;AnimatedModel\u0026gt;();\n\tif (model)\n\t{\n\t\tAnimationState* state = model-\u0026gt;GetAnimationState(eventData[P_NAME].GetString());\n\t\tif (state == NULL)\n\t\t\treturn;\n\n\n\t\tNode* bone = node_-\u0026gt;GetChild(eventData[P_DATA].GetString(), true);\n\n\t\tif (bone != NULL)\n\t\tPlaySound(\"Sounds/MasterchiefFootSteps.ogg\");\n\n\t}\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is really just the Character class that comes with Urho3d. Just some small changes.\u003c/p\u003e\n\u003cp\u003e\u003ca class=\"mention\" href=\"/u/jtippetts\"\u003e@JTippetts\u003c/a\u003e That makes sense. I removed that part about the melee trigger already though.\u003cbr\u003e\nSo if I have this: \u003ccode\u003eSubscribeToEvent(E_ANIMATIONTRIGGER, URHO3D_HANDLER(AIMelee, HandleAnimationTriggerZombie));\u003c/code\u003e\u003cbr\u003e\nThis will pickup all animation trigger events?\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2020-03-20T18:45:34.187Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":8.0,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36865,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2020-03-20T21:19:12.175Z","cooked":"\u003cp\u003eYes, if you subscribe to E_ANIMATIONTRIGGER in that fashion, then it will receive triggers from any and every object that ever sends an animation trigger event. You can see in Character::Start in your code, how it calls SubscribeToEvent(GetNode(), E_NODECOLLISION, ‚Ä¶) which means it will then only receive node collision events generated by it‚Äôs own Node, and not from all the other potential sources of node collision out there.\u003c/p\u003e\n\u003cp\u003eIn your AIMelee:::Start, you subscribe to E_NODECOLLISION events without specifying they should come from only the component‚Äôs owning Node. Similarly, in DelayedStart you subscribe to E_ANIMATIONTRIGGER events without qualifying them as coming from it‚Äôs own node. This means that each of those AIMelee objects will respond to trigger and collision events originating from every object in the game that sends those events, and not just from their own nodes.\u003c/p\u003e\n\u003cp\u003eYou should always be very clear on the flow of events through your game, and on who can respond to a given event, as this can cause hard-to-find issues.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2020-03-20T21:19:12.175Z","reply_count":0,"reply_to_post_number":10,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":18.0,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36867,"name":"","username":"lezak","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/b38774/{size}.png","created_at":"2020-03-20T21:29:45.311Z","cooked":"\u003cp\u003eTwo side notes:\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"GodMan\" data-post=\"1\" data-topic=\"6007\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/40.png\" class=\"avatar\"\u003e GodMan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSetUpdateEventMask(USE_FIXEDUPDATE);\u003cbr\u003e\nSetUpdateEventMask(USE_UPDATE);\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eThis way You‚Äôll end up only with update event, You should use SetUpdateEventMask(USE_FIXEDUPDATE | USE_UPDATE)\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"GodMan\" data-post=\"1\" data-topic=\"6007\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/40.png\" class=\"avatar\"\u003e GodMan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003ebody-\u0026gt;SetMass(1000000.0f);\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eSetting mass to 0 will make body static.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2020-03-20T21:29:45.311Z","reply_count":0,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":14,"readers_count":13,"score":17.8,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":688,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36868,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T21:34:11.145Z","cooked":"\u003cp\u003e\u003ca class=\"mention\" href=\"/u/jtippetts\"\u003e@JTippetts\u003c/a\u003e Thanks very informative. I have been studying what resources I could find. \u003ca class=\"mention\" href=\"/u/lezak\"\u003e@lezak\u003c/a\u003e Thanks for the suggestions. I have made the new changes.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2020-03-20T21:34:11.145Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":14,"readers_count":13,"score":2.8,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":36870,"name":"","username":"GodMan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","created_at":"2020-03-20T21:52:01.370Z","cooked":"\u003cp\u003eOkay everything seems to be working now. I also found out one of the animation trigger xml files for that animation the npcs where using has an issue. I may have fixed it before not realizing this. \u003ca class=\"mention\" href=\"/u/jtippetts\"\u003e@JTippetts\u003c/a\u003e I hade called\u003ccode\u003e GetNode()\u003c/code\u003e  in my debugging steps, but nothing worked and I assumed that was wrong. Their were most likely a few issues.\u003c/p\u003e\n\u003cp\u003eOne thing I never got working is the\u003ccode\u003e node-\u0026gt;Remove();\u003c/code\u003e when the NPC dies and gets removed after a certain amount of time. I got it from NinjaSnowWars. Oddly I repurposed it for my custom projectile class and it works great.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eEDIT:\u003c/strong\u003e You guys are not going to believe this, but the animation xml file had a small space before the .xml. This may have been working the whole time. Thanks everyone for the informative information. This help me improve my class.\u003c/p\u003e\n\u003cp\u003eI just need to figure out why the duration counter for node removal is not working.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eEDIT2\u003c/strong\u003e I fixed my Update issue. NPCs are now removed by the class after being dead for a certain amout of time. I also fixed the 3d sound issue. I was not using the player as the listener node. Now attenuation works great.\u003c/p\u003e\n\u003cp\u003eThanks everyone\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2020-03-21T19:31:28.514Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":15,"readers_count":14,"score":18.0,"yours":false,"topic_id":6007,"topic_slug":"animation-trigger-only-works-on-one-class","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":3,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":861,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[36828,36830,36833,36845,36851,36854,36855,36856,36857,36860,36865,36867,36868,36870]},"timeline_lookup":[[1,978],[5,977]],"suggested_topics":[{"id":7067,"title":"Can the latest Urho3D version be built with VS2013?","fancy_title":"Can the latest Urho3D version be built with VS2013?","slug":"can-the-latest-urho3d-version-be-built-with-vs2013","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":null,"created_at":"2021-11-25T18:00:24.336Z","last_posted_at":"2021-11-26T17:22:21.878Z","bumped":true,"bumped_at":"2021-11-26T17:22:21.878Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":157,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}}]},{"id":7080,"title":"Build urho3d source on windows 10 - cmake - \"Error in configuration process, project files may be invalid\"","fancy_title":"Build urho3d source on windows 10 - cmake - \u0026ldquo;Error in configuration process, project files may be invalid\u0026rdquo;","slug":"build-urho3d-source-on-windows-10-cmake-error-in-configuration-process-project-files-may-be-invalid","posts_count":8,"reply_count":4,"highest_post_number":8,"image_url":null,"created_at":"2021-12-03T01:55:53.267Z","last_posted_at":"2021-12-06T22:46:59.584Z","bumped":true,"bumped_at":"2021-12-06T22:46:59.584Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":324,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1488,"username":"ToolmakerSteve","name":"ToolmakerSteve","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ba9def/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}}]},{"id":7081,"title":"Install Urho3D Library - Windows 10 - rake build - \"project does not exist\"","fancy_title":"Install Urho3D Library - Windows 10 - rake build - \u0026ldquo;project does not exist\u0026rdquo;","slug":"install-urho3d-library-windows-10-rake-build-project-does-not-exist","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-03T03:06:40.974Z","last_posted_at":"2021-12-03T17:53:10.844Z","bumped":true,"bumped_at":"2021-12-03T17:53:10.844Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":190,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1488,"username":"ToolmakerSteve","name":"ToolmakerSteve","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ba9def/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1491,"username":"xlat","name":"Alex Kuch","avatar_template":"/user_avatar/discourse.urho3d.io/xlat/{size}/3620_2.png"}}]},{"id":7092,"title":"Finding the World Space Coordinates of the Screen Edges","fancy_title":"Finding the World Space Coordinates of the Screen Edges","slug":"finding-the-world-space-coordinates-of-the-screen-edges","posts_count":6,"reply_count":2,"highest_post_number":6,"image_url":null,"created_at":"2021-12-07T20:53:49.453Z","last_posted_at":"2021-12-08T12:33:52.510Z","bumped":true,"bumped_at":"2021-12-08T12:33:52.510Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":210,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}}]},{"id":7105,"title":"Multiple Application.UI Roots?","fancy_title":"Multiple Application.UI Roots?","slug":"multiple-application-ui-roots","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/7/74b10ce575f1b69fe43be4abcb07605d74a1d27c_2_1024x544.jpeg","created_at":"2021-12-20T08:55:14.707Z","last_posted_at":"2021-12-22T02:33:05.795Z","bumped":true,"bumped_at":"2021-12-22T02:33:05.795Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":243,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":6007,"title":"Animation Trigger only works on one class","fancy_title":"Animation Trigger only works on one class","posts_count":14,"created_at":"2020-03-20T00:57:05.313Z","views":273,"reply_count":4,"like_count":4,"last_posted_at":"2020-03-20T21:52:01.370Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"animation-trigger-only-works-on-one-class","category_id":10,"word_count":3440,"deleted_at":null,"user_id":861,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_6007","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":14,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":5,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png","post_count":8,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":0},{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":688,"username":"lezak","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/b38774/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"},"last_poster":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}}