{"post_stream":{"posts":[{"id":325,"name":"","username":"friesencr","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png","created_at":"2014-02-08T05:28:19.000Z","cooked":"\u003cp\u003epardon my c++ newbish.\u003c/p\u003e\n\u003cp\u003ei am trying to cast the workitem pointer from the completed event.\u003c/p\u003e\n\u003cp\u003emy code isn‚Äôt working so well:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ehere is the source code for the work queue\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eif (i-\u0026gt;sendEvent_)\n{\n    eventData[P_ITEM] = (void*)(\u0026amp;(*i));\n    SendEvent(E_WORKITEMCOMPLETED, eventData);\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThanks\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T00:57:51.571Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":21,"reads":11,"readers_count":10,"score":107.2,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":15,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":329,"name":"","username":"NemesisFS","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/d2c977/{size}.png","created_at":"2014-02-08T15:02:58.000Z","cooked":"\u003cp\u003eIt should work if you dont call GetPtr(). eventData[P_ITEM] is a void pointer, you just need to cast it to a WorkItem Pointer (if im not mistaken).\u003c/p\u003e\n\u003cp\u003eAlso I guess you should use ‚Äústatic_cast\u0026lt;WorkItem*\u0026gt;‚Äù.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T00:57:51.883Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":8,"reads":11,"readers_count":10,"score":42.2,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":19,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":330,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-08T16:01:14.000Z","cooked":"\u003cp\u003eActually your line should work. Here‚Äôs a complete somewhat stupid example, inserted into the StaticScene example.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003efloat resultVariable = 0.0f;\n\nvoid MyWork(const WorkItem* item, unsigned threadIndex)\n{\n    float* result = static_cast\u0026lt;float*\u0026gt;(item-\u0026gt;start_);\n    for (unsigned i = 0; i \u0026lt; 1024 * 1024 * 1024; ++i)\n        *result += sqrtf((float)i);\n}\n\nvoid StaticScene::Start()\n{\n    WorkItem item;\n    item.priority_ = 0;\n    item.start_ = \u0026amp;resultVariable;\n    item.workFunction_ = MyWork;\n    item.sendEvent_ = true;\n    \n    GetSubsystem\u0026lt;WorkQueue\u0026gt;()-\u0026gt;AddWorkItem(item);\n    SubscribeToEvent(E_WORKITEMCOMPLETED, HANDLER(StaticScene, HandleWorkItemCompleted));\n\n    ...\n}\n\nvoid StaticScene::HandleWorkItemCompleted(StringHash eventType, VariantMap\u0026amp; eventData)\n{\n    using namespace WorkItemCompleted;\n    WorkItem* item = static_cast\u0026lt;WorkItem*\u0026gt;(eventData[P_ITEM].GetPtr());\n    // This should also work just as well\n    // const WorkItem* item = (const WorkItem*)eventData[P_ITEM].GetPtr(); \n    \n    float* result = static_cast\u0026lt;float*\u0026gt;(item-\u0026gt;start_);\n    LOGINFO(\"Calculation result was \" + String(*result));\n}\u003c/code\u003e\u003c/pre\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T00:57:51.972Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":13,"readers_count":12,"score":2.6,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":334,"name":"","username":"friesencr","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png","created_at":"2014-02-09T00:46:53.000Z","cooked":"\u003cp\u003ei think i understand what is going on‚Ä¶  this is a very different way of thinking for me.  I think my head exploded.  I was able to cast the WorkItem from the beginning but the pointers didn‚Äôt match up.\u003c/p\u003e\n\u003cp\u003eI could be way off base.\u003c/p\u003e\n\u003cp\u003eI allocated my worker on ‚Äòthe stack‚Äô\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\tvoid CreateDungeon()\n\t{\n\t\tWorkItem item;\n\t\titem.sendEvent_ = true;\n\t\titem.workFunction_ = GenerateDungeonStart;\n\t\tdungeonWorker = \u0026amp;item;\n\t\tworkQueue-\u0026gt;AddWorkItem(item);\n\t}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAddWorkItem doesn‚Äôt take a pointer to a work item so it ‚Äòcopies‚Äô the variable.  After the scope of the function the dungeonWorker actually gets ‚Äònullified‚Äô.  I have no idea what it is pointing to after the item gets destroyed.  It amuses me that I will utilize allocating variables on stack to make it so i don‚Äôt cleanup but now I didn‚Äôt think of this inverted scenario.  My main motivation for using the pointer was to make it so i could track a work item and when the work item was completed to use the completed handler to and do some work based on the task that was completed.\u003c/p\u003e\n\u003cp\u003eThe api seems to be suited for splitting up work to utiltize multiple cores more effectively.  I think everytime i saw threads being used they ended up all blocking using the queue#complete function within the same frame.  I can see that there is some code to try to prevent too many tasks from running long:\u003c/p\u003e\n\u003cp\u003eThis is in the WorkerThread\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt looks like GetSubsystem is a singleton?  Since complete gets called every frame tasks would never be able to run more then a frame?  If I wanted to have a task run longer would I want to make a new WorkQueue for my game specific code?\u003c/p\u003e\n\u003cp\u003eIn the dreadful posibility of a single threaded system we might be able to add a WorkItem.current pointer to hold the current position of an iterator and suspend a task to pickup where it left off next frame for a longer running task as though as a sort of hackish coroutine.   maybe we can make the work function return a bool for whether it has been completed or not?\u003c/p\u003e\n\u003cp\u003ealso a posible improvement to the api would be for the ability to specifify a workitem in the subscribe method:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\u003c/code\u003e\u003c/pre\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T00:57:52.321Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":12,"readers_count":11,"score":2.4,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Core developer","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":15,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":341,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-10T10:13:50.000Z","cooked":"\u003cp\u003eA couple of things‚Ä¶\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eWhen you submit a task to the WorkQueue, it will get copied like you noticed, so the pointer in the completion event will be different. The WorkQueue has initially been used only for the Renderer‚Äôs internal tasks and the completion event facility has been an afterthought, so using them is not as convenient as it should be. If each WorkItem would be an Object it could send its own completion event, however there‚Äôs some overhead to that.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTasks will not be suspended, they always run to completion, and I don‚Äôt intend to change that. The 1000ms timer is only for the case when there are no worker threads. You should test if whether it makes more sense to you to actually allocate at least 1 worker thread even on a single-core system. You should not make another WorkQueue on your own, as that creates another batch of (number of CPUs) worker threads which may be too much. Instead the existing one can be used to run tasks that are as long as you want, just put a priority that is less than M_MAX_UNSIGNED on them, so that the time-critical renderer tasks (which have priority M_MAX_UNSIGNED) can also run on other free worker threads (or on the main thread) in the meanwhile.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T00:57:52.817Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":9,"readers_count":8,"score":1.8,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":350,"name":"","username":"Azalrion","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/f04885/{size}.png","created_at":"2014-02-10T13:26:01.000Z","cooked":"\u003cp\u003eHow about passing in a WorkItem pointer instead and having the ‚Äòkeep alive‚Äô list being a list of SharedPtr‚Äôs instead.\u003c/p\u003e\n\u003cp\u003eThat way the complete volatile boolean is usable outside of the WorkQueue and comparisons can be made as long as where the WorkItem was added keeps its own SharedPtr copy so that the memory isn‚Äôt freed when the WorkQueue cleanses complete items.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T00:57:53.424Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":9,"readers_count":8,"score":1.8,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":8,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":352,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-10T13:46:55.000Z","cooked":"\u003cp\u003eWe can support both forms, submitting SharedPtr‚Äôs to work items, and submitting a const reference (where WorkQueue will make a copy, just like before). The Renderer / View do not care of individual tasks after submitting, they only need them all to complete, so they‚Äôll continue to use the latter. When submitting pointers it‚Äôs important to check that the item isn‚Äôt already in the queue.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-01-02T00:57:53.564Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":353,"name":"","username":"Azalrion","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/f04885/{size}.png","created_at":"2014-02-10T14:14:34.000Z","cooked":"\u003cp\u003eIs there a need to support both apart from backward compatibility? Its easy enough to modify the render functions to use the shared pointer method, it reduces the complexity of the WorkQueue only supporting a single method, shouldn‚Äôt be much difference in performance either as you‚Äôve got two use cases copying the WorkItem or creating a new SharedPtr.\u003c/p\u003e\n\u003cp\u003eAnyway, added a pull request with the single version and Render functions refactored to see whether the single method is suitable.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-01-02T00:57:53.621Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":8,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":356,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-10T14:36:51.000Z","cooked":"\u003cp\u003eYes, it‚Äôs true that the performance of the methods doesn‚Äôt matter once we start using sharedptr‚Äôs to track the items, then it‚Äôs anyway a new dynamic allocation for each. Previously, as it was a list of items and not pointers, the allocations would be pooled internally like in a Vector.\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2017-01-02T00:57:53.836Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":361,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-10T22:25:52.000Z","cooked":"\u003cp\u003eTook the pull request as-is. It‚Äôs better to see outright in the client code that a new work item is being dynamically allocated. And of course it‚Äôs possible to reuse the same work item if it‚Äôs performed only once per frame \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/wink.png?v=5\" title=\":wink:\" class=\"emoji\" alt=\":wink:\"\u003e\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2017-01-02T00:57:54.160Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":9,"readers_count":8,"score":1.8,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":363,"name":"","username":"Azalrion","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/f04885/{size}.png","created_at":"2014-02-11T01:04:40.000Z","cooked":"\u003cp\u003eThat‚Äôs my next plan, refactor out all the cases in Octree and View where its based on the number of threads to re-use the pointers to save having them allocated every frame. Might be possible to do the same for render paths but thats slightly more risky as that can change during runtime, but a guard could be put in place to re-allocate if the number of render path commands changes.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2017-01-02T00:57:54.292Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":3,"reads":9,"readers_count":8,"score":16.8,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":8,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":366,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-11T10:05:29.000Z","cooked":"\u003cp\u003eA thought came to my mind that WorkQueue itself could allocate items into a ‚Äúfree‚Äù pool, to reuse them automatically.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2017-01-02T00:57:54.489Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":368,"name":"","username":"Azalrion","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/f04885/{size}.png","created_at":"2014-02-11T13:13:15.000Z","cooked":"\u003cp\u003eOh now that‚Äôs an interesting idea, just off the top of my head two ways to work it.\u003c/p\u003e\n\u003cp\u003eFirst you could do something like:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eSharedPtr\u0026lt;WorkItem\u0026gt; item = WorkQueue::GetWorkItem();\n// Do stuff.\nWorkQueue::AddItem(item); //We wouldn't want to add it to the active queue from the available pool till we know its ready.\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhich would be a bit more explicit but also would allow circumvention of the pool. The other method and one which I‚Äôm leaning towards could be something like:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eWorkItem item;\n// Do stuff.\nSharedPtr\u0026lt;WorkItem\u0026gt; reference = WorkQueue::AddItem(item);\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou‚Äôd have to do some conversions from the reference to copy the details from the passed reference to a free SharedPtr but it would mean that we could ensure all allocations were part of the pool.\u003c/p\u003e\n\u003cp\u003eOf course both would share behind the scenes stuff such as a separate queue for currently queued items and assigned items which wouldn‚Äôt change much between the current format. I‚Äôll have a play see what comes out of it, the big question would be on when would it be safe to shrink the queue down, perhaps maintain a delta between frames of the number of used / requested items and if it lasts then shrink down to remove one time or infrequent usage of the WorkQueue.\u003c/p\u003e\n\u003cp\u003eEdit:\u003c/p\u003e\n\u003cp\u003eSo had a play and decided that I prefer the flexibility of the first method where you can use the pool if you want or you can use your own SharedPtr allocation or even your own pool if you need to.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2017-01-02T00:57:54.623Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":8,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":371,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2014-02-11T15:59:41.000Z","cooked":"\u003cp\u003eI prefer the first method too for the freedom it gives you.\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2017-01-02T00:57:54.852Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":7,"readers_count":6,"score":1.4,"yours":false,"topic_id":82,"topic_slug":"solved-casting-p-item-from-workitemcompleted","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[325,329,330,334,341,350,352,353,356,361,363,366,368,371]},"timeline_lookup":[[1,3210],[4,3209],[5,3208],[10,3207]],"suggested_topics":[{"id":7074,"title":"First Person and 3rd person camera and water reflections","fancy_title":"First Person and 3rd person camera and water reflections","slug":"first-person-and-3rd-person-camera-and-water-reflections","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-01T18:37:28.669Z","last_posted_at":"2021-12-01T21:19:51.519Z","bumped":true,"bumped_at":"2021-12-01T21:19:51.519Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":158,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster, Accepted Answer","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7083,"title":"Using custom models in Xamarin.Forms shared project","fancy_title":"Using custom models in Xamarin.Forms shared project","slug":"using-custom-models-in-xamarin-forms-shared-project","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2021-12-03T08:34:21.895Z","last_posted_at":"2021-12-03T11:40:30.983Z","bumped":true,"bumped_at":"2021-12-03T11:40:30.983Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":198,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1493,"username":"Nikolai","name":"Nikolai Miroshnichenko","avatar_template":"/user_avatar/discourse.urho3d.io/nikolai/{size}/3632_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]},{"id":7097,"title":"View Physics event for ConvexCast","fancy_title":"View Physics event for ConvexCast","slug":"view-physics-event-for-convexcast","posts_count":11,"reply_count":5,"highest_post_number":11,"image_url":null,"created_at":"2021-12-09T23:56:27.507Z","last_posted_at":"2021-12-12T20:20:02.788Z","bumped":true,"bumped_at":"2021-12-12T20:20:02.788Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":6,"views":206,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7105,"title":"Multiple Application.UI Roots?","fancy_title":"Multiple Application.UI Roots?","slug":"multiple-application-ui-roots","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/optimized/2X/7/74b10ce575f1b69fe43be4abcb07605d74a1d27c_2_1024x544.jpeg","created_at":"2021-12-20T08:55:14.707Z","last_posted_at":"2021-12-22T02:33:05.795Z","bumped":true,"bumped_at":"2021-12-22T02:33:05.795Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":243,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7065,"title":"Angelscript: Loading a char file into a 2D array: how?","fancy_title":"Angelscript: Loading a char file into a 2D array: how?","slug":"angelscript-loading-a-char-file-into-a-2d-array-how","posts_count":7,"reply_count":4,"highest_post_number":7,"image_url":null,"created_at":"2021-11-24T09:20:05.420Z","last_posted_at":"2021-11-28T11:19:39.689Z","bumped":true,"bumped_at":"2021-11-28T11:26:00.375Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":239,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1491,"username":"xlat","name":"Alex Kuch","avatar_template":"/user_avatar/discourse.urho3d.io/xlat/{size}/3620_2.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":983,"username":"tarzeron","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ecae2f/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]}],"tags_descriptions":{},"id":82,"title":"[solved] casting P_ITEM from WorkItemCompleted","fancy_title":"[solved] casting P_ITEM from WorkItemCompleted","posts_count":14,"created_at":"2014-02-08T05:28:19.000Z","views":331,"reply_count":0,"like_count":0,"last_posted_at":"2014-02-11T15:59:41.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"solved-casting-p-item-from-workitemcompleted","category_id":10,"word_count":1511,"deleted_at":null,"user_id":15,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_82","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":14,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":4,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":3,"username":"cadaver","name":"Lasse √ñ√∂rni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":7,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":8,"username":"Azalrion","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/a/f04885/{size}.png","post_count":4,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":15,"username":"friesencr","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":19,"username":"NemesisFS","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/d2c977/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1}],"created_by":{"id":15,"username":"friesencr","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/friesencr/{size}/827_2.png"},"last_poster":{"id":3,"username":"cadaver","name":"Lasse √ñ√∂rni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png"}}}