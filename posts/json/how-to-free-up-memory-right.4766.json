{"post_stream":{"posts":[{"id":26997,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T18:49:19.672Z","cooked":"\u003cp\u003eI have classes like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eclass CWorldObject\n{\npublic: \nCWorldObject() :\n    m_body(nullptr),\n    m_collisionShape(nullptr)\n{\n    m_rootNode = EING_ST.graphic().scene()-\u0026gt;CreateChild();\n}\n\n~CWorldObject()\n{\n    m_rootNode-\u0026gt;UnsubscribeFromAllEvents();\n    m_rootNode-\u0026gt;Remove();\n}\n\nUrho3D::Node *rootNode()\n{\n    return m_rootNode;\n}\n\nUrho3D::RigidBody *body()\n{\n    if(!m_body)\n    {\n        m_body = rootNode()-\u0026gt;CreateComponent\u0026lt;Urho3D::RigidBody\u0026gt;();\n        m_body-\u0026gt;SetCollisionEventMode(Urho3D::COLLISION_ALWAYS);\n    }\n    return m_body;\n}\n\nUrho3D::CollisionShape *collisionShape()\n{\n    if(!m_collisionShape)\n    {\n        m_collisionShape = rootNode()-\u0026gt;CreateComponent\u0026lt;Urho3D::CollisionShape\u0026gt;();\n    }\n    return m_collisionShape;\n}\nprivate:\n    Urho3D::Node            *m_rootNode;\n    Urho3D::RigidBody       *m_body;\n    Urho3D::CollisionShape  *m_collisionShape;\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI do not understand how to free memory when removing such classes.\u003cbr\u003e\nI understand that it is necessary to delete each created object. But when I try to do it - the application crashes. Moreover, it abnormally terminates even with such a destructor as it is now.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2018-12-19T18:49:19.672Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":34,"reads":52,"readers_count":51,"score":180.4,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":26998,"name":"Jonathan","username":"Sinoid","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/{size}.png","created_at":"2018-12-19T19:09:22.587Z","cooked":"\u003cul\u003e\n\u003cli\u003eNode\u003c/li\u003e\n\u003cli\u003eRigidBody\u003c/li\u003e\n\u003cli\u003eCollisionShape\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eare all \u003ccode\u003eRefCounted\u003c/code\u003e objects.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI do not understand how to free memory when removing such classes.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eUse \u003ccode\u003eSharedPtr\u0026lt;T\u0026gt;\u003c/code\u003e and \u003ccode\u003eWeakPtr\u0026lt;T\u0026gt;\u003c/code\u003e, they will take care of the clean up for you (call reset when you want your local reference to be reset to null, which will \u003cstrong\u003enot\u003c/strong\u003e destroy the object it was referring to it unless it is no longer referenced anywhere).\u003c/p\u003e\n\u003cp\u003eEverything that derives from \u003ccode\u003eUrho3D::Component\u003c/code\u003e, \u003ccode\u003eUrho3D::Resource\u003c/code\u003e, and \u003ccode\u003eUrho3D::Node\u003c/code\u003e is reference counted - you don‚Äôt delete them outside of unusual circumstances.\u003c/p\u003e\n\u003cp\u003eYou‚Äôre deleting objects that are already being referenced elsewhere which is circumventing the smart pointer reference counting and mangling the program‚Äôs expected state resulting in it misusing memory when it attempts a function-call / member-access with one of those objects you deleted.\u003c/p\u003e\n\u003cp\u003eOutside of exceptional circumstances you should not be using raw pointers in any situation where you keep them around stored in a type (or anywhere), learn to use the smart pointer types.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMoreover, it abnormally terminates even with such a destructor as it is now.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThat‚Äôs going to be a matter of how the sequence of termination plays out. If the scene containing those objects is destroyed before your CWorldObject then that destructor will crash because the scene already freed all of those objects leaving you with dangling addresses because you used raw pointers.\u003c/p\u003e\n\u003cp\u003eThat same sequence of events will also mean that trying to delete them will crash because you‚Äôre attempting to delete already freed memory.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2018-12-19T19:09:22.587Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":51,"readers_count":50,"score":35.2,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"Jonathan","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":669,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27001,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T19:28:09.294Z","cooked":"\u003cp\u003eWell, let‚Äôs say I go to smart pointers (although I really, really don‚Äôt like them). How, then, to free up memory? Is it enough to call Remove () only for the m_rootNode, or do I need to call Remove () for each object that I explicitly create?\u003cbr\u003e\nCan I be sure that the memory is really free? How can I check this?\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2018-12-19T19:28:09.294Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":43,"readers_count":42,"score":8.6,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27006,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T21:45:49.503Z","cooked":"\u003cp\u003eI am rewrite class as\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eUrho3D::SharedPtr\u0026lt;Urho3D::Node\u0026gt;            m_rootNode;\nUrho3D::SharedPtr\u0026lt;Urho3D::RigidBody\u0026gt;       m_body;\nUrho3D::SharedPtr\u0026lt;Urho3D::CollisionShape\u0026gt;  m_collisionShape;\n...\nCWorldObject::CWorldObject()\n{\n    m_rootNode = EING_ST.graphic().scene()-\u0026gt;CreateChild();\n    m_body = m_rootNode-\u0026gt;CreateComponent\u0026lt;Urho3D::RigidBody\u0026gt;();\n    m_body-\u0026gt;SetCollisionEventMode(Urho3D::COLLISION_ALWAYS);\n    m_collisionShape = m_rootNode-\u0026gt;CreateComponent\u0026lt;Urho3D::CollisionShape\u0026gt;();\n}\n\nCWorldObject::~CWorldObject()\n{\n    m_rootNode-\u0026gt;UnsubscribeFromAllEvents();\n    m_collisionShape-\u0026gt;Remove();\n    m_body-\u0026gt;Remove();\n    m_rootNode-\u0026gt;Remove();\n}\n// ...\n// EING_ST - singleton (singleton::instance())\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow the application crashes when the pointer is released inside Ptr.h\u003cbr\u003e\n\u003ca href=\"http://paste.org.ru/?ly7dcv\" rel=\"nofollow noopener\"\u003eHere\u003c/a\u003e call stack, and \u003ca href=\"http://paste.org.ru/?6xtnlv\" rel=\"nofollow noopener\"\u003ehere\u003c/a\u003e full stack (crash in thread 1).\u003cbr\u003e\nPlease help me understand what I am doing wrong.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2018-12-19T21:52:46.873Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":41,"readers_count":40,"score":18.2,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://paste.org.ru/?6xtnlv","internal":false,"reflection":false,"title":"paste.org.ru","clicks":1},{"url":"http://paste.org.ru/?ly7dcv","internal":false,"reflection":false,"title":"paste.org.ru","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27010,"name":"","username":"Dave82","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png","created_at":"2018-12-19T22:28:42.564Z","cooked":"\u003cp\u003eTheoretically if you use smart pointers you dont need node-\u0026gt;Remove(). You can safely remove everything from destructor.The nodes will be removed when when CWorldObject is deleted\u003c/p\u003e\n\u003cp\u003eChange\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eCWorldObject::~CWorldObject()\n{\n    m_rootNode-\u0026gt;UnsubscribeFromAllEvents();\n    m_collisionShape-\u0026gt;Remove();\n    m_body-\u0026gt;Remove();\n    m_rootNode-\u0026gt;Remove();\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eto\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eCWorldObject::~CWorldObject()\n{\n\n}\u003c/code\u003e\u003c/pre\u003e","post_number":5,"post_type":1,"updated_at":"2018-12-19T22:30:03.544Z","reply_count":1,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":1,"reads":39,"readers_count":38,"score":32.8,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Sheridan","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":247,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27012,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T22:33:27.543Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"Dave82\" data-post=\"5\" data-topic=\"4766\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/dave82/40/2369_2.png\" class=\"avatar\"\u003e Dave82:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eto\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eCWorldObject::~CWorldObject()\n{\n\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eMaybe to\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eCWorldObject::~CWorldObject()\n{\n  scene()-\u0026gt;RemoveChild(m_rootNode);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e?\u003cbr\u003e\nSmart pointers really free memory? ‚Ä¶\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2018-12-19T22:33:27.543Z","reply_count":1,"reply_to_post_number":5,"quote_count":1,"incoming_link_count":0,"reads":35,"readers_count":34,"score":12.0,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27013,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T22:38:47.586Z","cooked":"\u003cp\u003eJust checked. If i leave the destructor empty, then the nodes are not removed from the scene. And if in the destructor, leave even just \u003ccode\u003escene()-\u0026gt;RemoveChild(m_rootNode);\u003c/code\u003e, then the application crashes.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2018-12-19T22:38:47.586Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":33,"readers_count":32,"score":11.6,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27014,"name":"","username":"Dave82","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png","created_at":"2018-12-19T22:39:14.091Z","cooked":"\u003caside class=\"quote no-group\" data-post=\"6\" data-topic=\"4766\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/sheridan/40/1835_1.png\" class=\"avatar\"\u003e Sheridan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSmart pointers really free memory? ‚Ä¶\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eSmart pointers are allocated on the stack within your class like any stack variable so if they go out of scope (delete your CWorldObject) all members of the object will be removed as well.\u003cbr\u003e\nSo to answer your question : Yes. You doun‚Äôt need to do anything with smart pointers. They will remove themselves.That‚Äôs the whole purpose of their existence\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-post=\"6\" data-topic=\"4766\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/sheridan/40/1835_1.png\" class=\"avatar\"\u003e Sheridan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCWorldObject::~CWorldObject() { scene()-\u0026gt;RemoveChild(m_rootNode); }\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eYou don‚Äôt need to do that. The bahavior is undefined in this case. If you remove the node from the scene your object‚Äôs smart pointer still holds a reference to that node.Only devs know what will happen during the release the ref on the object which is not part of the scene.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2018-12-19T22:44:16.710Z","reply_count":1,"reply_to_post_number":6,"quote_count":1,"incoming_link_count":0,"reads":33,"readers_count":32,"score":11.6,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":247,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27015,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T22:43:21.988Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"Dave82\" data-post=\"8\" data-topic=\"4766\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/dave82/40/2369_2.png\" class=\"avatar\"\u003e Dave82:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003e(delete your CWorldObject)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eMy class CWorldObject is not inherited from anything from Urho3D. It controls the node, but is not part of the scene itself.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003eclass CWorldObject\n{\npublic:\n    explicit CWorldObject();\n    virtual ~CWorldObject();\nprotected:\n    Urho3D::SharedPtr\u0026lt;Urho3D::Node\u0026gt;           \u0026amp;rootNode();\n    Urho3D::SharedPtr\u0026lt;Urho3D::RigidBody\u0026gt;      \u0026amp;body();\n    Urho3D::SharedPtr\u0026lt;Urho3D::CollisionShape\u0026gt; \u0026amp;collisionShape();\n    void subscribeToEvent(const EEvent \u0026amp;event, TUpdateFunction method, Urho3D::Node *targetNode = nullptr);\nprivate:\n    Urho3D::SharedPtr\u0026lt;Urho3D::Node\u0026gt;            m_rootNode;\n    Urho3D::SharedPtr\u0026lt;Urho3D::RigidBody\u0026gt;       m_body;\n    Urho3D::SharedPtr\u0026lt;Urho3D::CollisionShape\u0026gt;  m_collisionShape;\n// ... other methods and mrmbers\n\n};\n\u003c/code\u003e\u003c/pre\u003e","post_number":9,"post_type":1,"updated_at":"2018-12-19T22:43:21.988Z","reply_count":1,"reply_to_post_number":8,"quote_count":1,"incoming_link_count":0,"reads":34,"readers_count":33,"score":11.8,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27016,"name":"","username":"Dave82","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png","created_at":"2018-12-19T22:50:15.500Z","cooked":"\u003caside class=\"quote no-group\" data-post=\"7\" data-topic=\"4766\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/sheridan/40/1835_1.png\" class=\"avatar\"\u003e Sheridan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eJust checked. If i leave the destructor empty, then the nodes are not removed from the scene\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eYes you‚Äôre right.I was a bit confused what you are actually doing.\u003c/p\u003e\n\u003cp\u003em_rootNode-\u0026gt;Remove();\u003c/p\u003e\n\u003cp\u003eShould be perfectly ok without using smart pointers. Since All components are ref counted in nodes you don‚Äôt need to release them one by one.Just Remove your node and let your node remove al it‚Äôs components.I\u003c/p\u003e\n\u003cp\u003eSo change\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e\nCWorldObject::~CWorldObject()\n{\n      m_node-\u0026gt;Remove();\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd remove smart pointers and use regular pointers instead.\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2018-12-19T22:51:51.376Z","reply_count":0,"reply_to_post_number":7,"quote_count":1,"incoming_link_count":0,"reads":34,"readers_count":33,"score":6.8,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":247,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27017,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T22:59:46.713Z","cooked":"\u003cp\u003eStill crash in\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-auto\"\u003e1  Urho3D::RefCounted::ReleaseRef()                                                                                                           0x7ffff731dc44 \n2  Urho3D::Geometry::~Geometry()                                                                                                              0x7ffff73ac40d \n3  Urho3D::Geometry::~Geometry()                                                                                                              0x7ffff73ac4c9 \n4  Urho3D::Model::~Model()                                                                                                                    0x7ffff73cbcd5 \n5  Urho3D::Model::~Model()                                                                                                                    0x7ffff73cbe59 \n6  Urho3D::CollisionShape::~CollisionShape()                                                                                                  0x7ffff74f5611 \n7  Urho3D::CollisionShape::~CollisionShape()                                                                                                  0x7ffff74f5689 \n8  Urho3D::Node::RemoveComponent(Urho3D::RandomAccessIterator\u0026lt;Urho3D::SharedPtr\u0026lt;Urho3D::Component\u0026gt;\u0026gt;)                                          0x7ffff758f241 \n9  Urho3D::Node::RemoveComponents(bool, bool)                                                                                                 0x7ffff758f38e \n10 Urho3D::Node::~Node()                                                                                                                      0x7ffff758f448 \n11 Urho3D::Node::~Node()                                                                                                                      0x7ffff758f679 \n12 Urho3D::Node::RemoveChild(Urho3D::RandomAccessIterator\u0026lt;Urho3D::SharedPtr\u0026lt;Urho3D::Node\u0026gt;\u0026gt;)                                                   0x7ffff758eb1c \n13 eing::graphic::world::CWorldObject::~CWorldObject                                                                    cworldobject.cpp  57  0x4c835a       \n14 eing::graphic::world::CStaticObject::~CStaticObject                                                                  cstaticobject.cpp 26  0x4cde58       \n15 eing::graphic::world::CBlock::~CBlock                                                                                cblock.cpp        55  0x4993de       \n16 eing::graphic::world::CBlock::~CBlock                                                                                cblock.cpp        41  0x499489       \n17 eing_helper::cube::AppCubeHelper::redrawTestCube                                                                     main.cpp          351 0x45e6d5       \n18 eing_helper::cube::AppCubeHelper::HandleUpdate                                                                       main.cpp          289 0x45f92f       \n19 Urho3D::EventHandlerImpl\u0026lt;eing_helper::cube::AppCubeHelper\u0026gt;::Invoke                                                   Object.h          315 0x463337       \n20 Urho3D::Object::OnEvent(Urho3D::Object *, Urho3D::StringHash, Urho3D::HashMap\u0026lt;Urho3D::StringHash, Urho3D::Variant\u0026gt;\u0026amp;)                       0x7ffff732d642 \n21 Urho3D::Object::SendEvent(Urho3D::StringHash, Urho3D::HashMap\u0026lt;Urho3D::StringHash, Urho3D::Variant\u0026gt;\u0026amp;)                                       0x7ffff732e93f \n22 Urho3D::Engine::Update()                                                                                                                   0x7ffff734d1d7 \n23 Urho3D::Engine::RunFrame()                                                                                                                 0x7ffff735013a \n24 Urho3D::Application::Run()                                                                                                                 0x7ffff7342e45 \n25 main                                                                                                                 main.cpp          378 0x45faca       \n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI try with \u003ccode\u003em_node-\u0026gt;Remove();\u003c/code\u003e or \u003ccode\u003escene()-\u0026gt;RemoveChild(m_rootNode);\u003c/code\u003e in destrunctor\u003cbr\u003e\n\u003cimg src=\"https://emoji.discourse-cdn.com/twitter/frowning.png?v=6\" title=\":frowning:\" class=\"emoji\" alt=\":frowning:\"\u003e\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2018-12-19T22:59:46.713Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":23,"reads":34,"readers_count":33,"score":126.8,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27018,"name":"","username":"Dave82","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png","created_at":"2018-12-19T23:07:44.957Z","cooked":"\u003cp\u003eYour first example should work perfectly without any crash.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2018-12-19T23:07:44.957Z","reply_count":1,"reply_to_post_number":11,"quote_count":0,"incoming_link_count":0,"reads":32,"readers_count":31,"score":26.4,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Sheridan","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":247,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27019,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-19T23:08:38.272Z","cooked":"\u003cp\u003eThank you so much anyway. I will try to look for errors in another place.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2018-12-19T23:08:38.272Z","reply_count":0,"reply_to_post_number":12,"quote_count":0,"incoming_link_count":0,"reads":32,"readers_count":31,"score":6.4,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27027,"name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","username":"Modanung","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png","created_at":"2018-12-20T16:30:40.305Z","cooked":"\u003caside class=\"quote no-group\" data-post=\"9\" data-topic=\"4766\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt width=\"20\" height=\"20\" src=\"https://sjc6.discourse-cdn.com/standard17/user_avatar/discourse.urho3d.io/sheridan/40/1835_1.png\" class=\"avatar\"\u003e Sheridan:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMy class CWorldObject is not inherited from anything from Urho3D. It controls the node, but is not part of the scene itself.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eWhy not make \u003ccode\u003eCWorldObject\u003c/code\u003e inherit from \u003ccode\u003eUrho3D::Object\u003c/code\u003e?\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2018-12-20T16:31:07.863Z","reply_count":1,"reply_to_post_number":9,"quote_count":1,"incoming_link_count":0,"reads":31,"readers_count":30,"score":11.2,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":192,"hidden":false,"trust_level":0,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"user_suspended":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":27028,"name":"","username":"Sheridan","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","created_at":"2018-12-20T16:34:57.479Z","cooked":"\u003cp\u003eBecause I want to use smart pointers as little as possible, since I know exactly the lifetime of my objects. Moreover, CWorldObject is just the first brick in the inheritance tree of objects and, in addition to describing world objects, is also a proxy between the world and graphics.\u003c/p\u003e","post_number":15,"post_type":1,"updated_at":"2018-12-20T16:34:57.479Z","reply_count":0,"reply_to_post_number":14,"quote_count":0,"incoming_link_count":0,"reads":30,"readers_count":29,"score":6.0,"yours":false,"topic_id":4766,"topic_slug":"how-to-free-up-memory-right","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1081,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[26997,26998,27001,27006,27010,27012,27013,27014,27015,27016,27017,27018,27019,27027,27028]},"timeline_lookup":[[1,1434]],"suggested_topics":[{"id":7178,"title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","fancy_title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","slug":"medium-quality-technique-for-semi-reflective-specular-glass-in-urho","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/51408fe152ba02eb8b92237cc9a9411c8ee922e6.jpeg","created_at":"2022-01-31T22:57:50.134Z","last_posted_at":"2022-02-01T04:32:37.418Z","bumped":true,"bumped_at":"2022-02-01T04:32:37.418Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":154,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]},{"id":7179,"title":"Need help with cusomized PBR renderpath","fancy_title":"Need help with cusomized PBR renderpath","slug":"need-help-with-cusomized-pbr-renderpath","posts_count":4,"reply_count":0,"highest_post_number":4,"image_url":null,"created_at":"2022-02-01T09:04:58.692Z","last_posted_at":"2022-02-03T17:35:34.174Z","bumped":true,"bumped_at":"2022-02-03T17:35:34.174Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":13,"views":205,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":null,"description":"Original Poster, Accepted Answer","user":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}}]},{"id":7129,"title":"Best Model Import Pipeline as of Jan 2022?","fancy_title":"Best Model Import Pipeline as of Jan 2022?","slug":"best-model-import-pipeline-as-of-jan-2022","posts_count":7,"reply_count":0,"highest_post_number":7,"image_url":null,"created_at":"2022-01-17T09:27:23.432Z","last_posted_at":"2022-01-17T20:37:59.458Z","bumped":true,"bumped_at":"2022-01-17T20:37:59.458Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":4,"views":170,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":263,"username":"1vanK","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/1vank/{size}/768_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1038,"username":"dertom","name":"Thomas Trocha","avatar_template":"/user_avatar/discourse.urho3d.io/dertom/{size}/1815_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1165,"username":"throwawayerino","name":"Actually Permanent","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/da6949/{size}.png"}}]},{"id":7176,"title":"Orthographic scene slowing down when zooming out","fancy_title":"Orthographic scene slowing down when zooming out","slug":"orthographic-scene-slowing-down-when-zooming-out","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-01-30T10:05:50.218Z","last_posted_at":"2022-01-30T10:05:50.294Z","bumped":true,"bumped_at":"2022-01-30T10:05:50.294Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":127,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":1351,"username":"Haukinger","name":"Haukinger","avatar_template":"/user_avatar/discourse.urho3d.io/haukinger/{size}/3670_2.png"}}]},{"id":7243,"title":"Android compile fails","fancy_title":"Android compile fails","slug":"android-compile-fails","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2022-04-25T08:46:07.947Z","last_posted_at":"2022-05-06T08:22:51.592Z","bumped":true,"bumped_at":"2022-05-06T08:22:51.592Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":181,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":856,"username":"feresmu","name":null,"avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f08c70/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":4766,"title":"How to free up memory right?","fancy_title":"How to free up memory right?","posts_count":15,"created_at":"2018-12-19T18:49:19.608Z","views":668,"reply_count":9,"like_count":3,"last_posted_at":"2018-12-20T16:34:57.479Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"how-to-free-up-memory-right","category_id":10,"word_count":1266,"deleted_at":null,"user_id":1081,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_4766","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":15,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":4,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":1081,"username":"Sheridan","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png","post_count":9,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":1},{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png","post_count":4,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":0},{"id":669,"username":"Sinoid","name":"Jonathan","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/f19dbf/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":1081,"username":"Sheridan","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png"},"last_poster":{"id":1081,"username":"Sheridan","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/sheridan/{size}/1835_2.png"},"links":[{"url":"http://paste.org.ru/?6xtnlv","title":"paste.org.ru","internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":1081,"domain":"paste.org.ru","root_domain":"paste.org.ru"}]}}