{"post_stream":{"posts":[{"id":20004,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2017-08-09T04:50:26.623Z","cooked":"\u003cp\u003eI‚Äôm doing some refactoring on my game, and in the process I‚Äôm running up against a question that has cropped up for me a few times before: the question of how to implement prefab objects with parameters.\u003c/p\u003e\n\u003cp\u003eMy game makes heavy use of object templates that describe the overall structure of a node, but the individual script components require parameters that are specific for a particular instance of the object. Currently, I am making use of a system where a node and component hierarchy can be instanced from a template provided as a Lua table. I create the table, seed it with the various parameters, then pass it off to a Lua function that traverses a table and instances the node and component hierarchy. So I might have an object template for a fireball spell that looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003elocal desc=\n\t\t{\n\t\t\tComponents=\n\t\t\t{\n\t\t\t\t{Type=\"ParticleEmitter\", Material=\"Effects/flame.xml\", UpdateInvisible=false, NumParticles=500,\n\t\t\t\t\tSorted=false, Relative=false, MinRotationSpeed=-60, MaxRotationSpeed=60, MinDirection=Vector3(-0.25,-1,-0.25), MaxDirection=Vector3(0.25,-1,0.25),\n\t\t\t\t\tMinVelocity=0.5, MaxVelocity=1, MinParticleSize=Vector2(0.5, 0.5), MaxParticleSize=Vector2(0.75,0.75), MinEmissionRate=90, MaxEmissionRate=105,\n\t\t\t\t\tConstantForce=Vector3(0,1,0), SizeMul=Rect(0.5,0.5), FaceCamera=true, MinTimeToLive=0.5, MaxTimeToLive=1,\n\t\t\t\t\tColor=Color(0.1,0.045,0.35),\n\t\t\t\t},\n\t\t\t\t{Type=\"Light\", LightType=LIGHT_POINT, Color={r=1.5,g=0.75,b=0.45}, Range=4, CastShadows=true},\n\t\t\t\t{Type=\"ScriptObject\", Classname=\"SpawnedAction\", Parameters={ownernode=args.caster}},\n\t\t\t\t{Type=\"ScriptObject\", Classname=\"Projectile\", Parameters={startpos={x=myx,y=myy+0.25,z=myz}, endpos={x=targetpos.x,y=targety,z=targetpos.y}, speed=8, archeight=2}},\n\t\t\t\t{Type=\"ScriptObject\", Classname=\"ObjectSpawnerPayload\", Parameters={desc=fireballexplosion}},\n\t\t\t\t{Type=\"ScriptObject\", Classname=\"DamageSingleTargetPayload\",\n\t\t\t\t\tParameters=\n\t\t\t\t\t{\n\t\t\t\t\t\ttarget=args.hexmap:getObjectOrAuxID(args.targetx, args.targetz),\n\t\t\t\t\t\tattacker=args.caster,\n\t\t\t\t\t\tattack=\"test fireball\",\n\t\t\t\t\t\tdamage=dmg\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{Type=\"ScriptObject\", Classname=\"DoTPayload\", Parameters={dot={ttl=10, counter=0, attack=\"Fiery Corruption\", \n\t\t\t\t\tdamage=dmg, ownerid=args.caster:GetID()}}},\n\t\t\t\t{Type=\"CombatCameraControllerTemporary\"},\n\t\t\t}\n\t\t}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen I can instance the object from that description. The table is generated local to (in this example) a Spell:Execute function, which passes parameters (skill level, spell caster attack and damage modifiers, etc‚Ä¶) to those script objects that require them. Some of the parameters can be other object description tables (such as the ObjectSpawnerPayload script object, which spawns its designated object upon receipt of the TriggerPayload event, to make the fireball explode in a flash of particles). Since the table is built as a local when Execute is called, it is easy to seed the parameters to it upon table construction, so that the proper data is in place and available when the components are created.\u003c/p\u003e\n\u003cp\u003eHowever, this method is highly reliant upon Lua and doesn‚Äôt work as well in the statically-typed languages of C++ and AngelScript.\u003c/p\u003e\n\u003cp\u003eWhat I‚Äôm looking for is ideas on how to implement a similar system that isn‚Äôt tied to Lua. I have thought about using Scene::InstantiateJSON to instance from a JSON template, but I still have the issue of seeding the various parameters to the components. (Many of the parameters might be a struct or class type, such as DamageSingleTargetPayload which takes a DamageRecord structure.) If I try to construct the JSON description in-place like I do with the tables, then I have the problem of seeding these non-JSON-value type parameters throughout. I could generate the components without parameters, then iterate the instanced node hierarchy and all components, and set parameters manually after the template is instantiated, but this seems clunky and inelegant to me.\u003c/p\u003e\n\u003cp\u003eAnyone have any ideas? How do you guys handle prefab instancing with parameters?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-08-09T04:50:26.623Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":3,"reads":49,"readers_count":48,"score":24.8,"yours":false,"topic_id":3435,"topic_slug":"prefabs-with-parameters","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20013,"name":"","username":"Victor","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/3e96dc/{size}.png","created_at":"2017-08-09T13:28:17.046Z","cooked":"\u003cp\u003eHonestly, my approach has been that if I couldn‚Äôt describe it in JSON, then I created a C++ object for the case. This doesn‚Äôt work for everyone, but that‚Äôs just how I have tackled it so far.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-08-09T13:28:17.046Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":34,"readers_count":33,"score":6.8,"yours":false,"topic_id":3435,"topic_slug":"prefabs-with-parameters","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":461,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20024,"name":"SirNate0","username":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","created_at":"2017-08-09T19:14:24.964Z","cooked":"\u003cp\u003eI‚Äôve done a few things - in some cases, I‚Äôve just used the node‚Äôs user variables to store parameters, in other cases I‚Äôve made a new resource type (it may actually be a serializable, derived from the component class, I‚Äôm not sure right now - either way it ends up being about the same - requesting that it be loaded) that I use to construct the node hierarchy accordingly. One trick I‚Äôve also done for parametrizing (AngelScript) scripts is to declare all the parameters in one file, and then include the template script after that that uses all the parameters.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-08-09T19:14:24.964Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":33,"readers_count":32,"score":11.6,"yours":false,"topic_id":3435,"topic_slug":"prefabs-with-parameters","display_username":"SirNate0","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":628,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":20032,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2017-08-10T00:29:18.863Z","cooked":"\u003cp\u003eI‚Äôm thinking the way I might go is to build the node hierarchy using InstantiateJSON, then pass in custom data and instance-specific data using events. Most of my custom data structures (DamageRecord, SpellCastingContext, TargetList, etc‚Ä¶) can be broken down into a VariantMap representation, passed via event, and reconstituted on the other side. Works for AngelScript and LuaScript components as well.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-08-10T00:29:18.863Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":31,"readers_count":30,"score":6.2,"yours":false,"topic_id":3435,"topic_slug":"prefabs-with-parameters","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[20004,20013,20024,20032]},"timeline_lookup":[[1,1932],[3,1931]],"suggested_topics":[{"id":7328,"title":"Any Expense if Setting AnimationState.Time to Previous Value?","fancy_title":"Any Expense if Setting AnimationState.Time to Previous Value?","slug":"any-expense-if-setting-animationstate-time-to-previous-value","posts_count":5,"reply_count":2,"highest_post_number":5,"image_url":null,"created_at":"2022-09-19T17:51:43.462Z","last_posted_at":"2022-09-22T11:28:01.861Z","bumped":true,"bumped_at":"2022-09-22T11:28:01.861Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":115,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1456,"username":"Jens","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/j/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]},{"id":7350,"title":"Animation issue since VS2022 17.4 update","fancy_title":"Animation issue since VS2022 17.4 update","slug":"animation-issue-since-vs2022-17-4-update","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-11-14T19:17:11.829Z","last_posted_at":"2022-11-14T19:17:11.898Z","bumped":true,"bumped_at":"2022-11-14T19:17:11.898Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":44,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":174,"username":"franck22000","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/f/f4b2a3/{size}.png"}}]},{"id":7088,"title":"What Compiler is recommended for building Urho3D under Windows 7 32 bit?","fancy_title":"What Compiler is recommended for building Urho3D under Windows 7 32 bit?","slug":"what-compiler-is-recommended-for-building-urho3d-under-windows-7-32-bit","posts_count":4,"reply_count":1,"highest_post_number":4,"image_url":null,"created_at":"2021-12-06T07:50:47.867Z","last_posted_at":"2021-12-06T13:55:20.901Z","bumped":true,"bumped_at":"2021-12-06T13:55:20.901Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":2,"views":152,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1491,"username":"xlat","name":"Alex Kuch","avatar_template":"/user_avatar/discourse.urho3d.io/xlat/{size}/3620_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":4,"username":"weitjong","name":"Yao Wei Tjong","avatar_template":"/user_avatar/discourse.urho3d.io/weitjong/{size}/4_2.png"}}]},{"id":7194,"title":"Emscripten about Assimp","fancy_title":"Emscripten about Assimp","slug":"emscripten-about-assimp","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-02-15T08:00:39.256Z","last_posted_at":"2022-02-15T09:05:09.466Z","bumped":true,"bumped_at":"2022-02-15T09:05:09.466Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":160,"category_id":7,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":997,"username":"huminzheng","name":"huminzheng","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/h/9de0a6/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}}]},{"id":7101,"title":"Unique Per-Node Shader Uniform for Model-Particles","fancy_title":"Unique Per-Node Shader Uniform for Model-Particles","slug":"unique-per-node-shader-uniform-for-model-particles","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2021-12-16T03:16:09.579Z","last_posted_at":"2021-12-16T09:40:41.978Z","bumped":true,"bumped_at":"2021-12-16T09:40:41.978Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":139,"category_id":16,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}}]}],"tags_descriptions":{},"id":3435,"title":"Prefabs with parameters","fancy_title":"Prefabs with parameters","posts_count":4,"created_at":"2017-08-09T04:50:26.541Z","views":443,"reply_count":0,"like_count":0,"last_posted_at":"2017-08-10T00:29:18.863Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"prefabs-with-parameters","category_id":7,"word_count":812,"deleted_at":null,"user_id":30,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_3435","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":4,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","post_count":2,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":461,"username":"Victor","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/v/3e96dc/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png"},"last_poster":{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png"}}}