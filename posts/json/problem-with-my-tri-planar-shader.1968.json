{"post_stream":{"posts":[{"id":11726,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-16T17:36:22.000Z","cooked":"\u003cp\u003eI‚Äôve got a tri-planar shader in my game, that applies diffuse and normal maps to an object based on fragment position and normal. The code of the shader is at \u003ca href=\"http://pastebin.com/ySFYG5Ka\" rel=\"nofollow noopener\"\u003epastebin.com/ySFYG5Ka\u003c/a\u003e .\u003c/p\u003e\n\u003cp\u003eThe shader takes the incoming fragment position and uses the X and Z coordinates to calculate a texture coordinate for the detail textures and normal maps. Then it uses the normal to blend between three mappings of the detail shader, projecting the detail along each of the 3 axes. So far, it has worked well.\u003c/p\u003e\n\u003cp\u003eMy issue now is that I am attempting to provide a variation of the shader that combines the detail normal map with a model-specific normal map. In the shader code posted above, I have enclosed the model-normal specific sections in \u003cspan class=\"hashtag\"\u003e#ifdef\u003c/span\u003e MODELNORMAL blocks, with the MODELNORMAL being defined in the technique. For objects that want to use the model‚Äôs normal map, I use a technique with MODELNORMAL defined, and provide a normal\u003c/p\u003e\n\u003cp\u003eThe problem is that, while the shader works as expected with MODELNORMAL undefined, when MODELNORMAL is defined, somehow the fog coordinate gets stomped on. Here is a shot of the shader with MODELNORMAL not defined:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/R6QD7El.jpg\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003ehttp://i.imgur.com/R6QD7El.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHere is a shot with MODELNORMAL defined:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/yieq5Ur.png\" data-bbcode=\"true\" rel=\"nofollow noopener\"\u003ehttp://i.imgur.com/yieq5Ur.png\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eYou can see that in the second shot, the mountain model has the detail from its normal map, as well as the detail from the detail texture. However, the fog color is incorrect. The fog shading on the model stays constant, regardless of distance from the camera.\u003c/p\u003e\n\u003cp\u003eI have tried using TEXCOORD11 and TEXCOORD9 semantics for the input model normal, with no change. I‚Äôm not really a graphics programmer or shader expert, so I‚Äôm not really sure how to fix this, or even what exactly is going wrong. Anyone have any ideas?\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2017-01-02T01:11:55.592Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":51,"reads":7,"readers_count":6,"score":256.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/R6QD7El.jpg","internal":false,"reflection":false,"title":"R6QD7El.jpg","clicks":6},{"url":"http://i.imgur.com/yieq5Ur.png","internal":false,"reflection":false,"title":"yieq5Ur.png","clicks":4},{"url":"http://pastebin.com/ySFYG5Ka","internal":false,"reflection":false,"title":"#include \"Uniforms.hlsl\" #include \"Samplers.hlsl\" #include \"Transform.hlsl\" # - Pastebin.com","clicks":1}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11727,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-04-16T18:19:20.000Z","cooked":"\u003cp\u003eAre you on D3D11? Possibly for some reason the VS and PS disagree on the interpolators (mismatching defines?) Remember that on D3D11 their order has to be exactly same, ie. the semantics actually don‚Äôt help ordering them properly. The order in the shaders (assuming correct defines in both) seemed to be right, though.\u003c/p\u003e\n\u003cp\u003eIf it helps you, nothing prevents you defining input and output structs for VS -\u0026gt; PS communication, even if the Urho inbuilt shaders don‚Äôt use them.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-01-02T01:11:55.672Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":7,"readers_count":6,"score":11.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11729,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-16T22:22:26.000Z","cooked":"\u003cp\u003eThe error occurs, even if I use structs to pass to the PS:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://pastebin.com/Z058yA5z\" rel=\"nofollow noopener\"\u003epastebin.com/Z058yA5z\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIs it possible for there to be a mis-match even if using structs like this?\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2017-01-02T01:11:55.804Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":6,"readers_count":5,"score":11.2,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://pastebin.com/Z058yA5z","internal":false,"reflection":false,"title":"#include \"Uniforms.hlsl\" #include \"Samplers.hlsl\" #include \"Transform.hlsl\" # - Pastebin.com","clicks":2}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11730,"name":"","username":"rasteron","avatar_template":"/user_avatar/discourse.urho3d.io/rasteron/{size}/55_2.png","created_at":"2016-04-16T22:32:59.000Z","cooked":"\u003cp\u003eThere is gawag‚Äôs tri-planar wikia article and shader, maybe you can use this instead or at least get some information:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://urho3d.wikia.com/wiki/Tri-Planar_Texturing\" rel=\"nofollow noopener\"\u003eurho3d.wikia.com/wiki/Tri-Planar_Texturing\u003c/a\u003e\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-01-02T01:11:55.870Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":7,"readers_count":6,"score":1.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://urho3d.wikia.com/wiki/Tri-Planar_Texturing","internal":false,"reflection":false,"title":"Tri-Planar Texturing | Urho3D Wiki | Fandom powered by Wikia","clicks":4}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":54,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11732,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-16T22:47:21.000Z","cooked":"\u003cp\u003eThe problem isn‚Äôt with the tri-planar part, it‚Äôs with the combining it with a normal-mapped model that‚Äôs giving me issues.\u003c/p\u003e\n\u003cp\u003eDoing some further tinkering, I discovered something interesting. When I disable all lights (directional world lighting and player‚Äôs torch) and use only ambient, then it seems to work as expected (albeit boring because of no light):\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/L7tWmsU.png\" rel=\"nofollow noopener\"\u003ei.imgur.com/L7tWmsU.png\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf I then cast a Light Torch spell, it initially appears that I have the correct result:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/nspkeWh.png\" rel=\"nofollow noopener\"\u003ei.imgur.com/nspkeWh.png\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHowever, if I rotate the camera a little bit, the error pops in and out, ie moving the camera a little bit from the above view makes the incorrect fogging appear:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/Flp45MV.png\" rel=\"nofollow noopener\"\u003ei.imgur.com/Flp45MV.png\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis leads me to believe something is uninitialized or using bad data somewhere, since I can get a similar effect from not having a texture bound to a needed slot in other shaders. I have verified that all necessary textures are being bound.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-01-02T01:11:56.034Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":6,"readers_count":5,"score":1.2,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/L7tWmsU.png","internal":false,"reflection":false,"title":"L7tWmsU.png","clicks":0},{"url":"http://i.imgur.com/Flp45MV.png","internal":false,"reflection":false,"title":"Flp45MV.png","clicks":0},{"url":"http://i.imgur.com/nspkeWh.png","internal":false,"reflection":false,"title":"nspkeWh.png","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11743,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-04-17T13:28:46.000Z","cooked":"\u003cp\u003eThe problem could also be defining texcoord interpolators out of order. Make sure you have the correct defines and vertex+pixel shader combination set also in your lighting pass. For troubleshooting you could try unconditionally defining the interpolator right after the interpolators used by the lighting, even if it‚Äôs only used in the ‚Äúmodelnormal‚Äù mode.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-01-02T01:11:56.836Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":7,"readers_count":6,"score":1.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11748,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-17T18:21:13.000Z","cooked":"\u003cp\u003eOh, man. Okay, looks like defining input/output structures DID actually do the trick. I missed changing the VS designator in a Technique I was using, so it was still pointing to the old vertex shader, rather than the new one. Everything seems to be working great, now, with the side effect of the shader code being much neater, after having the parameters separated out into structures.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/hDI2lQx.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/hDI2lQx.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eLet this be a lesson: always double-check your techniques when doing shader modifications.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-01-02T01:11:57.177Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":7,"readers_count":6,"score":1.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/hDI2lQx.jpg","internal":false,"reflection":false,"title":"hDI2lQx.jpg","clicks":1}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11814,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-22T23:26:00.000Z","cooked":"\u003cp\u003eThere still seems to be something wrong that I can‚Äôt pin down.\u003c/p\u003e\n\u003cp\u003eI‚Äôm working on my game‚Äôs quest map (hence the weird usage of models in these following tests). I am currently using the tri-planar shader (without model normals) for landscape cells, and I am attempting to do the quest map as a render-to-texture scene, using normal-mapped mountain scenery. The mountains in this case are basic models using the DiffNormal technique. I whipped together a quick scene of mountains and built a Map Table, and this is the result:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/utjWvb7.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/utjWvb7.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eWeird, right? And that‚Äôs just using the mountain model with a DiffNormal shader. so, I made a test of using the mountain model as a piece in the main world map, and this was the result:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/baMwOiE.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/baMwOiE.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eSo here, the mountain works correctly, but now the tri-planar shader for the hex cells is borked. (It looks like the normals are wonky.)\u003c/p\u003e\n\u003cp\u003eI quit, and re-ran the exe with no changes, and the result was then this:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/PKRp50d.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/PKRp50d.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe tri-planar worked again, but this time the mountain was borked.\u003c/p\u003e\n\u003cp\u003eTried it with the hex cell model using the mountain‚Äôs shader:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/7gIPoWd.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/7gIPoWd.jpg\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://imgur.com/lx5QHI9\" rel=\"nofollow noopener\"\u003eimgur.com/lx5QHI9\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIt seems to be random which version will show up each time (DiffNormal borked or tri-planar borked). But it only affects models mapped with DiffNormal during the level generation phase. The units, including the goblin, also use DiffNormal and they are unaffected regardless of which way the terrain pieces are screwed up.\u003c/p\u003e\n\u003cp\u003eRemembering cadaver‚Äôs many comments on how D3D11 interpolators sometimes get confused, and remembering how using shader input and output structures helped me before, I modified the LitSolid hlsl shader to use structures, but the result was exactly the same.\u003c/p\u003e\n\u003cp\u003eTo me, it looks as if the normals are getting fouled up. Also, the mottled pattern of lighter and darker areas in the quest map screen shot makes me wonder if the blending texture used for terrain texture type splatting is also getting mixed in there somehow.\u003c/p\u003e\n\u003cp\u003eThe full shader code for the tri-planar shader is at \u003ca href=\"http://pastebin.com/b78ymBCN\" rel=\"nofollow noopener\"\u003epastebin.com/b78ymBCN\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI understand this is kind of a complex issue to try to debug, so I‚Äôm not really expecting any hard answers. But if anyone has any ideas on things I can try to track this down, I‚Äôd appreciate it.\u003c/p\u003e\n\u003cp\u003eEDIT: Looks like it is somehow breaking the model normal. I modified the shader to output model normals as diffuse.\u003c/p\u003e\n\u003cp\u003eUnborked:\u003cbr\u003e\n\u003ca href=\"http://i.imgur.com/HSCBYZF.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/HSCBYZF.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eBorked:\u003cbr\u003e\n\u003ca href=\"http://i.imgur.com/zrWZyTl.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/zrWZyTl.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eInterestingly, I tried a GL build, and the model normals get borked there also, but in a different way:\u003cbr\u003e\n\u003ca href=\"http://i.imgur.com/L7D4oPR.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/L7D4oPR.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI‚Äôm not sure how relevant this is to the current problem, since the GL shader was a quick job and I haven‚Äôt tested it thoroughly yet.\u003c/p\u003e\n\u003cp\u003eFurther Edit: Looks like the GL problem is related to lights somehow not affecting all instances of the hex cell model, rather than whatever is going on with the D3D11 version.\u003c/p\u003e\n\u003cp\u003eAnother Edit:\u003c/p\u003e\n\u003cp\u003eIf I disable the normal-mapping for the tri-planar shader, then everything works the way I expect it, in both D3D11 and GL, and both Forward and Deferred. (Note that the problem shows up in both Forward and Deferred modes, with normal-mapping enabled on the tri-planar.)\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/Ex2Et2e.png\" rel=\"nofollow noopener\"\u003ei.imgur.com/Ex2Et2e.png\u003c/a\u003e\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-01-02T01:12:01.711Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":7,"readers_count":6,"score":6.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/PKRp50d.jpg","internal":false,"reflection":false,"title":"PKRp50d.jpg","clicks":1},{"url":"http://i.imgur.com/utjWvb7.jpg","internal":false,"reflection":false,"title":"utjWvb7.jpg","clicks":1},{"url":"http://i.imgur.com/7gIPoWd.jpg","internal":false,"reflection":false,"title":"7gIPoWd.jpg","clicks":0},{"url":"http://i.imgur.com/HSCBYZF.jpg","internal":false,"reflection":false,"title":"HSCBYZF.jpg","clicks":0},{"url":"http://i.imgur.com/zrWZyTl.jpg","internal":false,"reflection":false,"title":"zrWZyTl.jpg","clicks":0},{"url":"http://i.imgur.com/L7D4oPR.jpg","internal":false,"reflection":false,"title":"L7D4oPR.jpg","clicks":0},{"url":"http://imgur.com/lx5QHI9","internal":false,"reflection":false,"title":"Imgur: The most awesome images on the Internet","clicks":0},{"url":"http://pastebin.com/b78ymBCN","internal":false,"reflection":false,"title":"#include \"Uniforms.hlsl\" #include \"Samplers.hlsl\" #include \"Transform.hlsl\" # - Pastebin.com","clicks":0},{"url":"http://i.imgur.com/Ex2Et2e.png","internal":false,"reflection":false,"title":"Ex2Et2e.png","clicks":0},{"url":"http://i.imgur.com/baMwOiE.jpg","internal":false,"reflection":false,"title":"baMwOiE.jpg","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11818,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-04-23T11:20:24.000Z","cooked":"\u003cp\u003eIf you can, try the HLSL shader in D3D9 (you‚Äôll have to adapt the code since you used explicit SM4+ constructs, and naturally you can‚Äôt read texture arrays, but just to debug if the normals break or not), which has simpler generation of vertex declarations that doesn‚Äôt depend on the shader being used. In D3D11 there could be a hash collision bug when generating input layout for the shader + vertex buffers combination.\u003c/p\u003e\n\u003cp\u003eNote that I‚Äôm testing with code past the merge of the arbitrary vertex declarations (current master branch), which changed instancing texcoord from TEXCOORD2 to TEXCOORD4, and I‚Äôm talking about hash collisions in terms of that code. Urho doesn‚Äôt backport fixes, so if a bug is uncovered and fixed, you will have to update to the latest master to gain benefit of that.\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2017-01-02T01:12:02.097Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":7,"readers_count":6,"score":1.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11819,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-04-23T12:42:30.000Z","cooked":"\u003cp\u003eIn current master branch input layout hashing is performed now so that vertex shader hash goes to upper 32 bits and vertex buffer hash to lower 32 bits. However this may not have anything to do with your issue. I tested your shader (though with no proper textures) and the vertex input elements shouldn‚Äôt actually be different to a standard LitSolid normalmapped shader.\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2017-01-02T01:12:02.167Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":7,"readers_count":6,"score":6.4,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11820,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-23T15:24:32.000Z","cooked":"\u003cp\u003eAfter pulling the latest master, it looks like it is working properly for D3D11.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/gUFliii.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/gUFliii.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eHowever, the GL build is completely broken:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/9zDtaFo.png\" rel=\"nofollow noopener\"\u003ei.imgur.com/9zDtaFo.png\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eNo errors logged to the logfile when trying to build the shaders or anything, just doesn‚Äôt work. If I disable the spawning of anything weird (ie, anything using a non-base Urho3D shader) it still doesn‚Äôt work. I get the fog color, I get the water planes, I get the characters, but the trees and plants and doodads tend to flicker in and out of existence as the camera moves around, or just plain not show up at all.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2017-01-02T01:12:02.237Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":5,"readers_count":4,"score":1.0,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/gUFliii.jpg","internal":false,"reflection":false,"title":"gUFliii.jpg","clicks":2},{"url":"http://i.imgur.com/9zDtaFo.png","internal":false,"reflection":false,"title":"9zDtaFo.png","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11821,"name":"Lasse √ñ√∂rni","username":"cadaver","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","created_at":"2016-04-23T16:11:37.000Z","cooked":"\u003cp\u003eGood to hear it‚Äôs working for D3D11. That points to the input layout hashes potentially having been the culprit.\u003c/p\u003e\n\u003cp\u003eCheck that your GL shaders conform to the arbitrary vertex element semantics, which are now zero-based:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efirst texcoord: iTexCoord0 (0 can be omitted)\u003c/li\u003e\n\u003cli\u003esecond texcoord: iTexCoord1\u003c/li\u003e\n\u003cli\u003einstance matrix: iTexCoord4, iTexCoord5, iTexCoord6\u003c/li\u003e\n\u003c/ul\u003e","post_number":12,"post_type":1,"updated_at":"2017-01-02T01:12:02.308Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":6,"readers_count":5,"score":1.2,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"Lasse √ñ√∂rni","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Urho3D Author","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":3,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11822,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-23T23:37:48.000Z","cooked":"\u003cp\u003eOkay, there was a little bit of breakage on my part (I changed/munged/hosed a LOT of stuff trying to figure this issue out) but I think I got it sorted. Was using an old version of some shader code for the GL build. Just cleaned out some stuff, and it looks like it is working as expected. This little sideroad was horrendously disruptive to my already chaotic process. \u003cimg src=\"https://emoji.discourse-cdn.com/twitter/smiley.png?v=5\" title=\":smiley:\" class=\"emoji\" alt=\":smiley:\"\u003e\u003c/p\u003e\n\u003cp\u003eThanks a LOT for your help, cadaver.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2017-01-02T01:12:02.372Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":5,"readers_count":4,"score":1.0,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":11828,"name":"","username":"JTippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","created_at":"2016-04-24T17:28:44.000Z","cooked":"\u003cp\u003eLooks like it is working pretty well now:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://i.imgur.com/eFlB7UP.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/eFlB7UP.jpg\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://i.imgur.com/gJ5gejI.jpg\" rel=\"nofollow noopener\"\u003ei.imgur.com/gJ5gejI.jpg\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAgain, thanks for your help.\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2017-01-02T01:12:02.748Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":5,"readers_count":4,"score":11.0,"yours":false,"topic_id":1968,"topic_slug":"problem-with-my-tri-planar-shader","display_username":"","primary_group_name":null,"flair_name":null,"flair_url":null,"flair_bg_color":null,"flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"http://i.imgur.com/eFlB7UP.jpg","internal":false,"reflection":false,"title":"eFlB7UP.jpg","clicks":2},{"url":"http://i.imgur.com/gJ5gejI.jpg","internal":false,"reflection":false,"title":"gJ5gejI.jpg","clicks":1}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":30,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[11726,11727,11729,11730,11732,11743,11748,11814,11818,11819,11820,11821,11822,11828]},"timeline_lookup":[[1,2411],[7,2410],[8,2405],[13,2404],[14,2403]],"suggested_topics":[{"id":7080,"title":"Build urho3d source on windows 10 - cmake - \"Error in configuration process, project files may be invalid\"","fancy_title":"Build urho3d source on windows 10 - cmake - \u0026ldquo;Error in configuration process, project files may be invalid\u0026rdquo;","slug":"build-urho3d-source-on-windows-10-cmake-error-in-configuration-process-project-files-may-be-invalid","posts_count":8,"reply_count":4,"highest_post_number":8,"image_url":null,"created_at":"2021-12-03T01:55:53.267Z","last_posted_at":"2021-12-06T22:46:59.584Z","bumped":true,"bumped_at":"2021-12-06T22:46:59.584Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":324,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":1488,"username":"ToolmakerSteve","name":"ToolmakerSteve","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/ba9def/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}}]},{"id":7178,"title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","fancy_title":"Medium-Quality Technique for Semi-Reflective/Specular Glass in Urho","slug":"medium-quality-technique-for-semi-reflective-specular-glass-in-urho","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":"https://global.discourse-cdn.com/standard17/uploads/urho3d/original/2X/5/51408fe152ba02eb8b92237cc9a9411c8ee922e6.jpeg","created_at":"2022-01-31T22:57:50.134Z","last_posted_at":"2022-02-01T04:32:37.418Z","bumped":true,"bumped_at":"2022-02-01T04:32:37.418Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":1,"views":154,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1334,"username":"najak3d","name":"Brian Knox","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/n/6a8cbe/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1317,"username":"Lys0gen","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/l/57b2e6/{size}.png"}}]},{"id":7123,"title":"Character hitboxes","fancy_title":"Character hitboxes","slug":"character-hitboxes","posts_count":24,"reply_count":16,"highest_post_number":24,"image_url":null,"created_at":"2022-01-10T19:34:24.617Z","last_posted_at":"2022-01-12T22:44:20.744Z","bumped":true,"bumped_at":"2022-01-12T22:44:20.744Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":275,"category_id":10,"featured_link":null,"has_accepted_answer":true,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster, Accepted Answer","user":{"id":192,"username":"Modanung","name":"È≠îÂ§ßÂÜú ùûçùûéùù≥ ÁèæÊãõËúç","avatar_template":"/user_avatar/discourse.urho3d.io/modanung/{size}/3290_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":484,"username":"Eugene","name":"Eugene Kozlov","avatar_template":"/user_avatar/discourse.urho3d.io/eugene/{size}/902_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":247,"username":"Dave82","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/dave82/{size}/2369_2.png"}}]},{"id":7127,"title":"Switching ribbon trails emission glitches transparent materials","fancy_title":"Switching ribbon trails emission glitches transparent materials","slug":"switching-ribbon-trails-emission-glitches-transparent-materials","posts_count":8,"reply_count":3,"highest_post_number":8,"image_url":null,"created_at":"2022-01-13T17:17:46.847Z","last_posted_at":"2022-02-10T08:10:49.330Z","bumped":true,"bumped_at":"2022-02-10T08:10:49.330Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":323,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":1188,"username":"Taqer","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/t/d2c977/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":631,"username":"JTippetts1","name":"J Tippetts","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts1/{size}/96_2.png"}}]},{"id":7185,"title":"Update Ray ray direction","fancy_title":"Update Ray ray direction","slug":"update-ray-ray-direction","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-02-05T00:28:45.414Z","last_posted_at":"2022-02-05T20:19:51.238Z","bumped":true,"bumped_at":"2022-02-05T20:19:51.238Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags_descriptions":{},"like_count":0,"views":144,"category_id":10,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":861,"username":"GodMan","name":"","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/g/e79b87/{size}.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":628,"username":"SirNate0","name":"SirNate0","avatar_template":"https://avatars.discourse-cdn.com/v4/letter/s/9f8e36/{size}.png"}}]}],"tags_descriptions":{},"id":1968,"title":"Problem with my tri-planar shader","fancy_title":"Problem with my tri-planar shader","posts_count":14,"created_at":"2016-04-16T17:36:22.000Z","views":428,"reply_count":0,"like_count":0,"last_posted_at":"2016-04-24T17:28:44.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"problem-with-my-tri-planar-shader","category_id":10,"word_count":1954,"deleted_at":null,"user_id":30,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1968","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":14,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"bookmarks":[],"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"slow_mode_enabled_until":null,"tags_disable_ads":false,"details":{"can_edit":false,"notification_level":1,"participants":[{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png","post_count":8,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2},{"id":3,"username":"cadaver","name":"Lasse √ñ√∂rni","avatar_template":"/user_avatar/discourse.urho3d.io/cadaver/{size}/3_2.png","post_count":5,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"admin":true,"trust_level":2},{"id":54,"username":"rasteron","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/rasteron/{size}/55_2.png","post_count":1,"primary_group_name":null,"flair_name":null,"flair_url":null,"flair_color":null,"flair_bg_color":null,"trust_level":2}],"created_by":{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png"},"last_poster":{"id":30,"username":"JTippetts","name":"","avatar_template":"/user_avatar/discourse.urho3d.io/jtippetts/{size}/357_2.png"},"links":[{"url":"http://urho3d.wikia.com/wiki/Tri-Planar_Texturing","title":"Tri-Planar Texturing | Urho3D Wiki | Fandom powered by Wikia","internal":false,"attachment":false,"reflection":false,"clicks":4,"user_id":54,"domain":"urho3d.wikia.com","root_domain":"wikia.com"},{"url":"http://pastebin.com/Z058yA5z","title":"#include \"Uniforms.hlsl\" #include \"Samplers.hlsl\" #include \"Transform.hlsl\" # - Pastebin.com","internal":false,"attachment":false,"reflection":false,"clicks":2,"user_id":30,"domain":"pastebin.com","root_domain":"pastebin.com"},{"url":"http://pastebin.com/ySFYG5Ka","title":"#include \"Uniforms.hlsl\" #include \"Samplers.hlsl\" #include \"Transform.hlsl\" # - Pastebin.com","internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":30,"domain":"pastebin.com","root_domain":"pastebin.com"}]}}